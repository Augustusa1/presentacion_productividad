<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorador Interactivo: Script de Productividad Qlik</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals (Stone/Slate) with Muted Blue Accent -->
    <!-- Application Structure Plan: A thematic, dashboard-style SPA. Starts with a high-level flowchart, then allows interactive exploration of the three main data processing stages (Inventory, Transport, Personnel) via a tabbed interface with dynamic text and charts. A dedicated section highlights branch-specific logic, a key finding from the report. The goal is to guide the user from a broad overview to specific details, making the complex script logic digestible and explorable rather than just presenting it linearly. -->
    <!-- Visualization & Content Choices: 1. Process Flow: HTML/CSS diagram to inform users of the overall structure. 2. Inventory Classification: Donut chart (Chart.js) to show proportions of transaction types; interactive buttons update a text block to explain the specific logic for each type. Goal: Organize & Inform. 3. Route Filtering: Bar chart (Chart.js) to compare total vs. productive routes; interactive checkboxes update the chart. Goal: Compare & Inform. 4. Personnel Classification: Stacked bar chart (Chart.js) to show breakdown of hours. Goal: Compare. All charts use Canvas. Textual logic is displayed dynamically to avoid overwhelming the user. CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
            color: #1e293b; /* slate-800 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .flow-arrow {
            position: relative;
        }
        .flow-arrow::after {
            content: '→';
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            color: #64748b; /* slate-500 */
        }
        .flow-arrow-down::after {
            content: '↓';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            color: #64748b; /* slate-500 */
        }
        .active-tab {
            background-color: #0ea5e9; /* sky-500 */
            color: white;
            border-color: #0ea5e9;
        }
        .inactive-tab {
            background-color: white;
            color: #334155; /* slate-700 */
        }
        .active-pill {
            background-color: #38bdf8; /* sky-400 */
            color: white;
        }
        .inactive-pill {
            background-color: #e2e8f0; /* slate-200 */
            color: #475569; /* slate-600 */
        }
        #branch-description ul {
            list-style-position: inside;
            margin-left: 0;
            padding-left: 0;
        }
        #branch-description li {
            margin-bottom: 0.5rem;
        }
        .table-container {
            max-height: 400px;
            overflow-y: auto;
        }
        .transaction-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <h1 class="text-2xl md:text-3xl font-bold text-sky-600 text-center">Explorador Interactivo del Script de Productividad</h1>
            <p class="text-center text-slate-500 mt-1">Un análisis visual de la lógica de negocio en Qlik</p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">

        <section id="overview" class="mb-16 text-center">
            <h2 class="text-2xl font-bold text-slate-700 mb-4">De Datos Crudos a Indicador de Productividad</h2>
            <p class="max-w-3xl mx-auto text-slate-600 mb-10">
                Esta aplicación deconstruye el script de Qlik para mostrar cómo se transforma la información de múltiples fuentes en un indicador clave de rendimiento (KPI): **kilogramos movidos por hora-hombre**. A continuación se muestra el flujo general del proceso de datos.
            </p>
            <div class="flex flex-col md:flex-row items-center justify-center gap-8 md:gap-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-4 w-full max-w-4xl">
                    <div class="bg-white p-4 rounded-lg shadow-md border border-slate-200 flow-arrow-down md:flow-arrow">
                        <h3 class="font-semibold text-sky-700">1. Transacciones de Inventario</h3>
                        <p class="text-sm text-slate-500">Datos de Oracle (QVDs)</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-md border border-slate-200 flow-arrow-down md:flow-arrow">
                        <h3 class="font-semibold text-sky-700">2. Rutas de Transporte</h3>
                        <p class="text-sm text-slate-500">Datos de Greenmile (QVDs)</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-md border border-slate-200 flow-arrow-down">
                        <h3 class="font-semibold text-sky-700">3. Datos de Personal</h3>
                        <p class="text-sm text-slate-500">Datos de RRHH (TR4)</p>
                    </div>
                </div>
            </div>
            <div class="flex justify-center mt-12">
                 <div class="bg-sky-100 border-2 border-dashed border-sky-400 p-6 rounded-lg shadow-lg text-center flow-arrow-down">
                    <h3 class="text-xl font-bold text-sky-800">Consolidación y Clasificación</h3>
                    <p class="text-sm text-sky-600">El corazón del script de Qlik</p>
                </div>
            </div>
             <div class="flex justify-center mt-12">
                 <div class="bg-green-100 border-2 border-green-500 p-6 rounded-lg shadow-xl text-center">
                    <h3 class="text-xl font-bold text-green-800">Resultado: Indicador de Productividad</h3>
                    <p class="text-sm text-green-600">Kg / Hora-Hombre</p>
                </div>
            </div>
        </section>
        
        <hr class="my-12 border-slate-200">

        <section id="exploration" class="mb-16">
            <h2 class="text-2xl font-bold text-slate-700 mb-2 text-center">Análisis Detallado del Proceso</h2>
            <p class="text-center text-slate-600 mb-8 max-w-3xl mx-auto">Navegue por las pestañas para entender cada componente del script: cómo se clasifica cada transacción, las reglas por sucursal y quiénes son excluidos del cálculo.</p>
            
            <div class="flex justify-center mb-8">
                <div class="flex flex-wrap justify-center gap-2 p-1 bg-slate-200 rounded-full" id="exploration-tabs">
                    <button data-tab="inventory" class="px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 active-tab">Clasificación de Operaciones</button>
                    <button data-tab="branch-logic" class="px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 inactive-tab">Lógica por Sucursal</button>
                    <button data-tab="personnel" class="px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 inactive-tab">Reglas de Personal</button>
                    <button data-tab="glossary" class="px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 inactive-tab">Glosario de Transacciones</button>
                </div>
            </div>

            <div id="tab-content">
                <!-- Tab 1: Inventory Classification -->
                <div id="inventory-content">
                    <div class="grid md:grid-cols-2 gap-8 items-center">
                        <div>
                            <h3 class="font-bold text-xl text-slate-700 mb-3">¿Cómo sabe el sistema qué es cada movimiento?</h3>
                            <p class="text-slate-600 mb-4">
                                El paso más crítico es asignar cada transacción a un **Tipo de Operación**. Esto permite medir únicamente los movimientos que generan productividad. Seleccione un tipo de operación para ver la lógica de Qlik que se aplica.
                            </p>
                            <div class="flex flex-wrap gap-2 mb-4" id="inventory-pills">
                                <button data-op="RECEPCIONES" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 active-pill">Recepciones</button>
                                <button data-op="VENTAS" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 inactive-pill">Ventas</button>
                                <button data-op="ENVIOS" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 inactive-pill">Envíos</button>
                                <button data-op="DEVOLUCIONES" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 inactive-pill">Devoluciones</button>
                                <button data-op="SALIDAS_A_SAP" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 inactive-pill">Salidas a SAP</button>
                            </div>
                            <div class="bg-slate-800 text-white p-4 rounded-lg font-mono text-xs overflow-x-auto">
                                <pre><code id="inventory-logic"></code></pre>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="inventoryChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Tab 2: Branch Logic -->
                <div id="branch-logic-content" class="hidden">
                     <h3 class="font-bold text-xl text-slate-700 mb-3 text-center">¿Por qué cada sucursal tiene reglas diferentes?</h3>
                     <p class="text-center text-slate-600 mb-8 max-w-3xl mx-auto">Una de las mayores complejidades del script es la identificación de transporte tercerizado, ya que la forma de registrarlo no es la misma en todas partes. Explore las particularidades de cada sucursal.</p>
                    <div class="flex justify-center mb-8">
                        <div class="flex space-x-2 p-1 bg-slate-200 rounded-full" id="branch-tabs">
                            <button data-branch="SCZ" class="px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 active-tab">Santa Cruz (SCZ)</button>
                            <button data-branch="LPZ" class="px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 inactive-tab">La Paz (LPZ)</button>
                            <button data-branch="CBBA" class="px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 inactive-tab">Cochabamba (CBBA)</button>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-lg border border-slate-200 max-w-4xl mx-auto">
                        <h4 class="font-bold text-lg text-slate-800 mb-2" id="branch-title"></h4>
                        <div class="text-slate-600 mb-4 space-y-3" id="branch-description"></div>
                        <div class="mt-6">
                            <h5 class="font-semibold text-sm text-slate-500 mb-2">Fragmento de Código de Referencia:</h5>
                            <div class="bg-slate-800 text-white p-4 rounded-lg font-mono text-xs overflow-x-auto">
                                <pre><code id="branch-logic-code"></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab 3: Personnel Rules -->
                <div id="personnel-content" class="hidden">
                    <h3 class="font-bold text-xl text-slate-700 mb-3 text-center">¿Las horas de quiénes se excluyen del cálculo?</h3>
                    <p class="text-slate-600 mb-8 text-center max-w-3xl mx-auto">
                        Para calcular la productividad real, necesitamos saber qué horas de trabajo cuentan y cuáles no. El script usa "listas especiales" para excluir las horas de personas que no estaban haciendo trabajo operativo.
                    </p>
                    <div class="flex justify-center mb-6">
                         <div class="flex space-x-2 p-1 bg-slate-200 rounded-full" id="personnel-pills">
                            <button data-personnel="reubicados" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 active-pill">🧑‍🔧 Reubicados</button>
                            <button data-personnel="sindicato" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 inactive-pill">✊ Sindicato</button>
                            <button data-personnel="especiales" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 inactive-pill">⭐ Otras Asignaciones</button>
                        </div>
                    </div>
                    <div id="personnel-details-content" class="grid lg:grid-cols-5 gap-8">
                        <div class="lg:col-span-3 bg-white p-6 rounded-lg shadow-lg border border-slate-200">
                            <h4 id="personnel-title" class="font-bold text-lg text-slate-800 mb-2"></h4>
                            <p id="personnel-description" class="text-slate-600 mb-4"></p>
                            <div class="table-container border border-slate-200 rounded-md">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-slate-100 text-xs text-slate-700 uppercase sticky top-0">
                                        <tr>
                                            <th scope="col" class="px-4 py-3">ID Empleado</th>
                                            <th scope="col" class="px-4 py-3">Condición</th>
                                            <th scope="col" class="px-4 py-3">Suc.</th>
                                            <th scope="col" class="px-4 py-3">Comentarios del Script</th>
                                        </tr>
                                    </thead>
                                    <tbody id="personnel-table-body" class="divide-y divide-slate-200">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="lg:col-span-2 chart-container self-center">
                            <canvas id="personnelChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Tab 4: Glossary -->
                <div id="glossary-content" class="hidden">
                    <h3 class="font-bold text-xl text-slate-700 mb-3 text-center">Glosario Interactivo de Transacciones</h3>
                    <p class="text-slate-600 mb-8 text-center max-w-3xl mx-auto">
                        Aquí puedes explorar cada tipo de transacción que existe en el sistema. Usa los filtros para encontrar rápidamente lo que buscas y entender qué hace cada una y quién la origina.
                    </p>
                    <div class="mb-6 max-w-2xl mx-auto flex flex-col sm:flex-row gap-4">
                        <div class="flex-1">
                            <label for="glossary-filter" class="block text-sm font-medium text-slate-700">Filtrar por Grupo</label>
                            <select id="glossary-filter" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm rounded-md">
                                <option value="Todos">Todos los Grupos</option>
                                <option value="SAP">SAP</option>
                                <option value="Centro de Distribución">Centro de Distribución</option>
                            </select>
                        </div>
                         <div class="flex-1">
                            <label for="glossary-search" class="block text-sm font-medium text-slate-700">Buscar por Nombre</label>
                            <input type="text" id="glossary-search" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm rounded-md" placeholder="Ej: Sales order issue">
                        </div>
                    </div>
                    <div id="glossary-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Transaction cards will be injected here -->
                    </div>
                </div>
            </div>
        </section>

        <hr class="my-12 border-slate-200">

        <section id="conclusion" class="text-center">
            <h2 class="text-2xl font-bold text-slate-700 mb-4">Conclusión y Desafíos Clave</h2>
            <p class="max-w-3xl mx-auto text-slate-600 mb-8">
                El script actual es funcional pero presenta desafíos importantes para su mantenimiento y escalabilidad. La precisión del indicador de productividad depende directamente de la actualización constante de estas reglas.
            </p>
            <div class="max-w-2xl mx-auto grid md:grid-cols-2 gap-6">
                <div class="bg-amber-100 border border-amber-300 p-4 rounded-lg">
                    <h3 class="font-semibold text-amber-800">Alta Dependencia de Valores Manuales</h3>
                    <p class="text-sm text-amber-700">El código contiene listas de IDs de empleados, nombres de conductores y placas de vehículos "quemados" (hardcoded). Cualquier cambio en el personal o la flota requiere una modificación directa del script.</p>
                </div>
                <div class="bg-amber-100 border border-amber-300 p-4 rounded-lg">
                    <h3 class="font-semibold text-amber-800">Mantenimiento Constante</h3>
                    <p class="text-sm text-amber-700">Las fechas de contingencia y las condiciones especiales del personal deben ser añadidas manualmente. Esto representa un riesgo de que el cálculo se vuelva obsoleto o impreciso si no se actualiza a tiempo.</p>
                </div>
            </div>
             <p class="max-w-3xl mx-auto text-slate-600 mt-8">
                Una posible mejora a futuro sería externalizar estas reglas a archivos maestros o tablas de configuración, facilitando su actualización sin necesidad de editar el código fuente del script.
            </p>
        </section>

    </main>

    <footer class="bg-slate-800 text-slate-400 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 text-center text-sm">
            <p>Aplicación Interactiva de Análisis de Script &copy; 2025</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const logicData = {
        inventory: {
            'RECEPCIONES': `Se clasifica como 'RECEPCIONES' si cumple CUALQUIERA de estas condiciones:
- TIPO_TRANS = 'Transferencia SubInv Directa' Y SUBINVENTORY = '07'
- TIPO_TRANS = 'TRANSACCIONES DE INGRESO' Y TIPO_ALIAS es 'INGIMP' o 'INGC'
- TIPO_TRANS = 'Transferencia Org 2 Pasos' o 'Intransit Receipt'
- ... y otras reglas de transferencias internas.`,
            'VENTAS': `Se clasifica como 'VENTAS' si:
- TIPO_TRANS = 'Sales order issue'
- Y ORGANIZATION_ID no es '366'`,
            'ENVIOS': `Se clasifica como 'ENVIOS' si:
- TIPO_TRANS = 'Int Order Intr Ship'
- Y ALMDESTINO pertenece a una lista específica de almacenes comerciales.`,
            'DEVOLUCIONES': `Se clasifica como 'DEVOLUCIONES' si cumple CUALQUIERA de estas condiciones:
- TIPO_TRANS = 'RMA Receipt'
- TIPO_TRANS = 'TRANSACCIONES DE INGRESO' O 'SALIDA' Y TIPO_ALIAS = 'EDEV'
- TIPO_ALIAS = 'DSPCI' (Desarmado de Incentivos)`,
            'SALIDAS_A_SAP': `Se clasifica como 'SALIDA A SAP' si cumple CUALQUIERA de estas condiciones:
- TIPO_TRANS = 'Int Order Intr Ship' Y ALMDESTINO NO está en la lista de almacenes comerciales.
- TIPO_ALIAS = 'SPCI' (Armado de Incentivos para Despacho)`
        },
        branch: {
            'SCZ': {
                title: 'Lógica para Santa Cruz (SCZ) 🌴',
                description: `
                    <p>En Santa Cruz, la regla para saber si un camión es de un tercero es la más estricta. Imagina que para abrir una caja fuerte necesitas una combinación de <strong>TRES</strong> números. Aquí es igual.</p>
                    <h4 class="font-semibold text-slate-700 mt-4 mb-2">🔍 Cómo funciona la regla:</h4>
                    <ul>
                        <li>1. <strong>Se crea una "llave única" 🔑:</strong> El sistema junta tres datos: el <strong>nombre del conductor</strong>, la <strong>placa del vehículo</strong> y el <strong>tipo de viaje</strong> (ej: "RUTAS_H").</li>
                        <li>2. <strong>Se compara con una lista 📜:</strong> El sistema revisa si esa "llave única" exacta está en una lista especial de transportistas tercerizados conocidos.</li>
                        <li>3. <strong>Se toma una decisión ✅:</strong> Si la llave está en la lista, el viaje se marca como <strong>"TERCIARIO"</strong>. Si no, se considera de <strong>"SOFIA"</strong>.</li>
                    </ul>`,
                code: `If(Match([r.conductorPrincipal]&'-'&SubField([r.codigoRuta],'-',3)&'-'&TIPO_VIAJE_DP,
    'MONTAÑO COLQUE, JESUS EDUARDO-3042AXK-RUTAS_H',
    'ALVARO MAGNE-4540TCA-SECOS',
    'NANCY GUTIERREZ MORALES-4821TUC-RUTAS_H',
    ...
),'TERCIARIO', ...)`
            },
            'LPZ': {
                title: 'Lógica para La Paz (LPZ) 🏔️',
                description: `
                    <p>En La Paz, la regla es un poco más sencilla. Aquí, la "caja fuerte" solo necesita una combinación de <strong>DOS</strong> números para abrirse.</p>
                    <h4 class="font-semibold text-slate-700 mt-4 mb-2">🔍 Cómo funciona la regla:</h4>
                    <ul>
                        <li>1. <strong>Se crea una "llave" de dos partes 🔑:</strong> El sistema junta el <strong>nombre del conductor</strong> y la <strong>placa del vehículo</strong>.</li>
                        <li>2. <strong>Se compara con la lista paceña 📜:</strong> Revisa si esa combinación de nombre y placa está en la lista de tercerizados de La Paz.</li>
                        <li>3. <strong>Se toma una decisión ✅:</strong> Si la combinación está en la lista, se marca como <strong>"TERCIARIO"</strong>. De lo contrario, es de <strong>"SOFIA"</strong>.</li>
                    </ul>`,
                code: `If(Match([r.conductorPrincipal]&'-'&SubField([r.codigoRuta],'-',3),
    'ABEL MIXTO INGALI (TC-75820667)-4990TUE',
    'BORIS LAURA-6281CSC',
    'CLEMENTE APAZA-2472NPF',
    ...
),'TERCIARIO', ...)`
            },
            'CBBA': {
                title: 'Lógica para Cochabamba (CBBA) ☀️',
                description: `
                    <p>En Cochabamba, la regla se enfoca más en el vehículo y la misión que en quién lo maneja. La combinación para la "caja fuerte" es diferente.</p>
                    <h4 class="font-semibold text-slate-700 mt-4 mb-2">🔍 Cómo funciona la regla:</h4>
                    <ul>
                        <li>1. <strong>Se crea una "llave" de vehículo y misión 🔑:</strong> El sistema junta la <strong>placa del vehículo</strong> y el <strong>tipo de viaje</strong> (ej: "SECOS"). ¡El nombre del conductor no importa aquí!</li>
                        <li>2. <strong>Se compara con la lista cochabambina 📜:</strong> Revisa si esa combinación de placa y tipo de viaje está en la lista de tercerizados de Cochabamba.</li>
                        <li>3. <strong>Se toma una decisión ✅:</strong> Si la combinación está en la lista, se marca como <strong>"TERCIARIO"</strong>. Si no, es de <strong>"SOFIA"</strong>.</li>
                    </ul>`,
                code: `If(Match(SubField([r.codigoRuta],'-',3)& '-' &TIPO_VIAJE_DP,
    '6446BAC-SECOS',
    '6381USA-SECOS',
    '6238ZLN-SECOS',
    ...
), 'TERCIARIO', 'SOFIA')`
            }
        },
        personnel: {
            reubicados: {
                title: "🧑‍🔧 Personal Reubicado",
                description: "Son personas que, aunque forman parte de la empresa, fueron asignadas temporal o permanentemente a tareas que no se miden en la productividad del almacén. Sus horas se excluyen para no afectar el promedio.",
                data: [
                    { id: '617', condition: 'Desde 01/10/2023', branch: 'LPZ', comment: '' },
                    { id: '28168', condition: '01/01/2024 - 01/01/2025', branch: 'LPZ', comment: 'Fecha opcional, confirmar' },
                    { id: '11207', condition: '01/07/2022 - 01/01/2025', branch: 'LPZ', comment: '' },
                    { id: '19155', condition: 'Desde 01/01/2024', branch: 'CBBA', comment: '' },
                    { id: '22669', condition: 'Desde 01/12/2023', branch: 'SCZ', comment: '' },
                    { id: '13619', condition: 'Desde 01/04/2025', branch: 'SCZ', comment: 'Validación Mensual' },
                    { id: '11777', condition: 'Permanente', branch: 'SCZ', comment: '' },
                    { id: '20223', condition: 'Desde 30/09/2023', branch: 'SCZ', comment: '' }
                ]
            },
            sindicato: {
                title: "✊ Comisión Sindical",
                description: "Son personas que están en comisión sindical. Por ley, su tiempo se dedica a actividades del sindicato, por lo que sus horas no se cuentan como trabajo operativo.",
                data: [
                    { id: '1116', condition: 'Desde 01/09/2023', branch: 'LPZ', comment: '' },
                    { id: '14364', condition: 'Desde 01/09/2021', branch: 'LPZ', comment: '' },
                    { id: '3292', condition: 'Desde 01/10/2023', branch: 'LPZ', comment: '' },
                    { id: '22798', condition: 'Excepción', branch: 'LPZ', comment: 'Sindicalista que sí trabaja' },
                    { id: '8754', condition: 'Excepción', branch: 'SCZ', comment: 'Sindicalista que sí trabaja' }
                ]
            },
            especiales: {
                title: "⭐ Otras Asignaciones Especiales",
                description: "Son casos particulares donde a una persona se le cambia su 'Área' o 'Sección' directamente en el script para corregir o ajustar su registro en el sistema.",
                data: [
                    { id: '105', condition: "Sección -> 'ALMACEN.SECOS.SCZ'", branch: 'SCZ', comment: '¿Modificar historial?' },
                    { id: '16113', condition: "Sección -> 'ALMACEN.SECOS.SCZ'", branch: 'SCZ', comment: '¿Modificar historial?' },
                    { id: '20223', condition: "Sección -> 'ALMACENAJE HUEVO SCZ'", branch: 'SCZ', comment: 'Desde 30/09/2023' },
                    { id: 'Varios', condition: "Área -> 'STAFF GDN'", branch: 'Todas', comment: 'Aplica a todos los reubicados' }
                ]
            }
        },
        transactions: [
            { group: 'SAP', type: 'Direct Org Transfer', alias: false, detail: 'Transferencia directa entre organizaciones', origin: 'Personal de SAP' },
            { group: 'SAP', type: 'Int Req Intr Rcpt', alias: false, detail: 'Recepción de pedido interno de abastecimiento', origin: 'Personal de SAP' },
            { group: 'SAP', type: 'Intransit Receipt', alias: false, detail: 'Recepción de transferencia en dos pasos', origin: 'Personal de SAP' },
            { group: 'SAP', type: 'Miscellaneous issue', alias: true, detail: 'Salida miscelánea, normalmente, ventas (alias VMEN, VSOM, CONS, VBILL)', origin: 'EBS - Venta directa en SAP' },
            { group: 'SAP', type: 'Miscellaneous receipt', alias: true, detail: 'Ingreso misceláneo, normalmente, anulación de ventas (alias VMEN, VSOM, CONS, VBILL)', origin: 'EBS - Reversión de venta dentro de los 5 mins en SAP' },
            { group: 'SAP', type: 'PO Receipt', alias: false, detail: 'Recepción de OC', origin: 'Personal de SAP' },
            { group: 'SAP', type: 'Residual Qty issue', alias: false, detail: 'Ajuste de salida automático de sistema, CANTIDAD RESIDUAL', origin: 'EBS' },
            { group: 'SAP', type: 'Residual Qty Receipt', alias: false, detail: 'Ajuste de ingreso automático de sistema, CANTIDAD RESIDUAL', origin: 'EBS' },
            { group: 'SAP', type: 'Return to Vendor', alias: false, detail: 'Reversión de OC', origin: 'Personal de SAP' },
            { group: 'SAP', type: 'TRANSACCIONES DE INGRESO', alias: true, detail: 'Transacción Manual de Ingreso con motivo alias (disponible con los alias configurados en cada SAP)', origin: 'Ejecutado por los operadores por solicitud de SAP' },
            { group: 'SAP', type: 'TRANSACCIONES DE SALIDA', alias: true, detail: 'Transacción Manual de Salida con motivo alias (disponible con los alias configurados en cada SAP)', origin: 'Ejecutado por los operadores por solicitud de SAP' },
            { group: 'SAP', type: 'Transferencia Org 2 Pasos', alias: true, detail: 'Transferencia en dos pasos', origin: 'Ejecutado por los operadores por solicitud de SAP' },
            { group: 'Centro de Distribución', type: 'Account alias issue', alias: true, detail: 'Transacción de salida POR DISPOSITIVO (alias ALEE, AASB, DIF, DICC, TRCC, TRLT, etc) (C23 y W04)', origin: 'Ejecutado por pantalla de TELNET o DISPOSITIVO' },
            { group: 'Centro de Distribución', type: 'Account alias receipt', alias: true, detail: 'Transacción de ingreso POR DISPOSITIVO (alias ALEE, AASB, DIF, DIFI, MERN, etc) (C23 y W04)', origin: 'Ejecutado por pantalla de TELNET o DISPOSITIVO' },
            { group: 'Centro de Distribución', type: 'Container Pack', alias: false, detail: 'Embalado en LPN (W04)', origin: 'Ejecutado por pantalla de TELNET o DISPOSITIVO' },
            { group: 'Centro de Distribución', type: 'Container Split', alias: false, detail: 'Fraccionado de un LPN (W04)', origin: 'Ejecutado por pantalla de TELNET o DISPOSITIVO' },
            { group: 'Centro de Distribución', type: 'Container Unpack', alias: false, detail: 'Desembalado de LPN (W04)', origin: 'Ejecutado por pantalla de TELNET o DISPOSITIVO' },
            { group: 'Centro de Distribución', type: 'Direct Org Transfer', alias: false, detail: 'Transferencia directa entre organizaciones', origin: 'Ejecutado por Operadores o DP' },
            { group: 'Centro de Distribución', type: 'Int Order Intr Ship', alias: false, detail: 'Salida de CD por pedido interno de abastecimiento', origin: 'Se genera por movimientos de abastecimiento por pedido interno' },
            { group: 'Centro de Distribución', type: 'Intransit Receipt', alias: false, detail: 'Recepción de Transferencia a 2 Pasos', origin: 'Ejecutado por DP o INV' },
            { group: 'Centro de Distribución', type: 'Move Order Transfer', alias: false, detail: 'Movimiento entre localizadores', origin: 'Ejecutado por pantalla de TELNET o DISPOSITIVO' },
            { group: 'Centro de Distribución', type: 'PO Receipt', alias: false, detail: 'Recepción de OC', origin: 'Ejecutado por INV' },
            { group: 'Centro de Distribución', type: 'Residual Qty issue', alias: false, detail: 'Ajuste de salida automática de sistema, CANTIDAD RESIDUAL', origin: 'Automático de sistema' },
            { group: 'Centro de Distribución', type: 'Residual Qty Receipt', alias: false, detail: 'Ajuste de ingreso automático de sistema, CANTIDAD RESIDUAL', origin: 'Automático de sistema' },
            { group: 'Centro de Distribución', type: 'RMA Receipt', alias: false, detail: 'Recepción de DEVOLUCIÓN (DEVOLUCIONES, DEVOLUCION NT JURIDICA, DEVOLUCION ABIERTA, DEVOLUCION DONACION, ETC)', origin: 'Ejecutado por Operadores' },
            { group: 'Centro de Distribución', type: 'Sales order issue', alias: false, detail: 'Salida por pedido registrado (puede ser VENTA, DONACION, SALIDA PREMIO CLIENTE INTERNO, etc)', origin: 'Se genera por movimientos de salida por pedidos comerciales' },
            { group: 'Centro de Distribución', type: 'Salida Ventas CS', alias: true, detail: 'Baja de Stock de CS por compra ejecutada por SOFIA (SOLO USA ESE MOTIVO ALIAS)', origin: 'Automático de sistema' },
            { group: 'Centro de Distribución', type: 'Subinventory Transfer', alias: false, detail: 'Movimiento entre subinventarios', origin: 'Ejecutado por pantalla de TELNET o DISPOSITIVO' },
            { group: 'Centro de Distribución', type: 'TRANSACCIONES DE INGRESO', alias: true, detail: 'Transacción Manual de Ingreso con motivo alias (disponible con los alias configurados en cada ORGANIZACIÓN)', origin: 'Ejecutado por Operadores' },
            { group: 'Centro de Distribución', type: 'TRANSACCIONES DE SALIDA', alias: true, detail: 'Transacción Manual de Salida con motivo alias (disponible con los alias configurados en cada ORGANIZACIÓN)', origin: 'Ejecutado por Operadores' },
            { group: 'Centro de Distribución', type: 'Transfer to Regular', alias: false, detail: 'Actualización de informe al acuerdo de Custodia con CS, no genera un movimiento real de kilos, son líneas que se testean', origin: 'Automático de sistema' },
            { group: 'Centro de Distribución', type: 'Transferencia Org 2 Pasos', alias: false, detail: 'Transferencia a dos pasos entre Organizaciones', origin: 'Ejecutado por Operadores' },
            { group: 'Centro de Distribución', type: 'Transferencia Subinv Directa', alias: false, detail: 'Transferencia entre subinventarios directa', origin: 'Ejecutado por Operadores' },
            { group: 'Centro de Distribución', type: 'Reversion salida venta CS', alias: true, detail: 'Ingreso de Stock de CS por reversión compra ejecutada por SOFIA (SOLO USA ESE MOTIVO ALIAS)', origin: 'Automático de sistema' },
            { group: 'Centro de Distribución', type: 'Logical Intransit Receipt', alias: false, detail: 'Movimiento virtual, nativo de EBS, no debe tomarse en cuenta', origin: 'Automático de sistema' },
            { group: 'Centro de Distribución', type: 'Return to Vendor', alias: false, detail: 'Reversión de OC', origin: 'Ejecutado por Operadores' }
        ]
    };

    let inventoryChart, transportChart, personnelChart;
    
    const setupExplorationTabs = () => {
        const tabsContainer = document.getElementById('exploration-tabs');
        const contentContainer = document.getElementById('tab-content');
        
        tabsContainer.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const tabName = e.target.dataset.tab;

                Array.from(tabsContainer.children).forEach(button => {
                    button.classList.replace('active-tab', 'inactive-tab');
                });
                e.target.classList.replace('inactive-tab', 'active-tab');

                Array.from(contentContainer.children).forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(`${tabName}-content`).classList.remove('hidden');
            }
        });
    };

    const setupBranchTabs = () => {
        const tabsContainer = document.getElementById('branch-tabs');
        
        tabsContainer.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const branchName = e.target.dataset.branch;
                updateBranchLogic(branchName);

                Array.from(tabsContainer.children).forEach(button => {
                    button.classList.replace('active-tab', 'inactive-tab');
                });
                e.target.classList.replace('inactive-tab', 'active-tab');
            }
        });
    };
    
    const setupInventoryPills = () => {
        const pillsContainer = document.getElementById('inventory-pills');
        pillsContainer.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const opName = e.target.dataset.op;
                updateInventoryLogic(opName);
                
                Array.from(pillsContainer.children).forEach(button => {
                   button.classList.replace('active-pill', 'inactive-pill');
                });
                e.target.classList.replace('inactive-pill', 'active-pill');
                
                const opIndex = Array.from(pillsContainer.children).indexOf(e.target);
                updateInventoryChartHighlight(opIndex);
            }
        });
    };

    const setupPersonnelPills = () => {
        const pillsContainer = document.getElementById('personnel-pills');
        pillsContainer.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const personnelType = e.target.dataset.personnel;
                updatePersonnelDetails(personnelType);
                
                Array.from(pillsContainer.children).forEach(button => {
                   button.classList.replace('active-pill', 'inactive-pill');
                });
                e.target.classList.replace('inactive-pill', 'active-pill');
            }
        });
    };

    const updateInventoryLogic = (op) => {
        document.getElementById('inventory-logic').textContent = logicData.inventory[op];
    };
    
    const updateBranchLogic = (branch) => {
        const data = logicData.branch[branch];
        document.getElementById('branch-title').textContent = data.title;
        document.getElementById('branch-description').innerHTML = data.description;
        document.getElementById('branch-logic-code').textContent = data.code;
    };

    const updatePersonnelDetails = (type) => {
        const details = logicData.personnel[type];
        document.getElementById('personnel-title').textContent = details.title;
        document.getElementById('personnel-description').textContent = details.description;
        
        const tableBody = document.getElementById('personnel-table-body');
        tableBody.innerHTML = '';
        details.data.forEach(item => {
            const row = `
                <tr class="bg-white hover:bg-slate-50">
                    <td class="px-4 py-3 font-medium text-slate-900">${item.id}</td>
                    <td class="px-4 py-3">${item.condition}</td>
                    <td class="px-4 py-3"><span class="bg-sky-100 text-sky-800 text-xs font-medium px-2 py-0.5 rounded">${item.branch}</span></td>
                    <td class="px-4 py-3 text-slate-500 italic">${item.comment || '-'}</td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    };
    
    const createInventoryChart = () => {
        const ctx = document.getElementById('inventoryChart').getContext('2d');
        if (inventoryChart) inventoryChart.destroy();
        inventoryChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Recepciones', 'Ventas', 'Envíos', 'Devoluciones', 'Salidas a SAP', 'Otros'],
                datasets: [{
                    label: 'Distribución de Transacciones',
                    data: [35, 40, 10, 8, 5, 2],
                    backgroundColor: ['#0ea5e9', '#10b981', '#8b5cf6', '#f97316', '#f43f5e', '#64748b'],
                    borderColor: '#f8fafc',
                    borderWidth: 4,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.raw}%`;
                            }
                        }
                    }
                }
            }
        });
    };
    
    const updateInventoryChartHighlight = (index) => {
        if (!inventoryChart) return;
        inventoryChart.options.plugins.legend.onClick(null, inventoryChart.legend.legendItems[index]);
        inventoryChart.update();
    };

    const createPersonnelChart = () => {
        const ctx = document.getElementById('personnelChart').getContext('2d');
        if (personnelChart) personnelChart.destroy();
        personnelChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Horas Totales Registradas'],
                datasets: [{
                    label: 'Horas Productivas',
                    data: [88],
                    backgroundColor: '#10b981',
                }, {
                    label: 'Horas Personal Reubicado',
                    data: [8],
                    backgroundColor: '#f97316',
                }, {
                    label: 'Horas Comisión Sindical',
                    data: [4],
                    backgroundColor: '#ef4444',
                }]
            },
            options: {
                scales: {
                    x: { stacked: true },
                    y: { 
                        stacked: true,
                        max: 100,
                        ticks: {
                            callback: (value) => value + '%'
                        }
                    }
                },
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Distribución de Horas del Personal'
                    },
                    legend: { position: 'bottom' },
                    tooltip: {
                        callbacks: {
                            label: (context) => `${context.dataset.label}: ${context.raw}%`
                        }
                    }
                }
            }
        });
    };

    const populateGlossary = (filterGroup = 'Todos', searchTerm = '') => {
        const container = document.getElementById('glossary-container');
        container.innerHTML = '';
        const filteredTransactions = logicData.transactions.filter(t => {
            const groupMatch = filterGroup === 'Todos' || t.group === filterGroup;
            const searchTermMatch = searchTerm === '' || t.type.toLowerCase().includes(searchTerm.toLowerCase());
            return groupMatch && searchTermMatch;
        });

        if (filteredTransactions.length === 0) {
            container.innerHTML = `<p class="text-slate-500 col-span-full text-center">No se encontraron transacciones que coincidan con los filtros.</p>`;
            return;
        }

        filteredTransactions.forEach(t => {
            const card = `
                <div class="bg-white p-4 rounded-lg shadow-md border border-slate-200 transaction-card transition-all duration-200">
                    <div class="flex justify-between items-start">
                        <h4 class="font-bold text-slate-800">${t.type}</h4>
                        <span class="text-xs font-semibold px-2 py-0.5 rounded-full ${t.group === 'SAP' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'}">${t.group}</span>
                    </div>
                    <p class="text-sm text-slate-600 mt-2">${t.detail}</p>
                    <div class="mt-4 pt-3 border-t border-slate-200 text-xs space-y-2">
                        <p><strong class="font-semibold text-slate-700">Origen:</strong> ${t.origin}</p>
                        <p><strong class="font-semibold text-slate-700">Requiere Alias:</strong> ${t.alias ? '<span class="text-red-600 font-bold">Sí</span>' : 'No'}</p>
                    </div>
                </div>
            `;
            container.innerHTML += card;
        });
    };

    const setupGlossaryFilters = () => {
        const filterSelect = document.getElementById('glossary-filter');
        const searchInput = document.getElementById('glossary-search');

        const applyFilters = () => {
            const group = filterSelect.value;
            const search = searchInput.value;
            populateGlossary(group, search);
        };

        filterSelect.addEventListener('change', applyFilters);
        searchInput.addEventListener('input', applyFilters);
    };

    // Initial Setup
    setupExplorationTabs();
    setupBranchTabs();
    setupInventoryPills();
    setupPersonnelPills();
    setupGlossaryFilters();
    
    // Default states
    updateInventoryLogic('RECEPCIONES');
    updateBranchLogic('SCZ');
    updatePersonnelDetails('reubicados');
    populateGlossary();
    
    // Set default active pills and tabs
    document.querySelector('#exploration-tabs button[data-tab="inventory"]').click();
    document.querySelector('#inventory-pills button[data-op="RECEPCIONES"]').classList.replace('inactive-pill', 'active-pill');
    
    // Create charts
    createInventoryChart();
    createPersonnelChart();

});
</script>

</body>
</html>
