<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorador Interactivo: Script de Productividad Qlik</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals (Stone/Slate) with Muted Blue Accent -->
    <!-- Application Structure Plan: A thematic, dashboard-style SPA. Starts with a high-level flowchart, then allows interactive exploration of the three main data processing stages (Inventory, Transport, Personnel) via a tabbed interface with dynamic text and charts. A dedicated section highlights branch-specific logic, a key finding from the report. The goal is to guide the user from a broad overview to specific details, making the complex script logic digestible and explorable rather than just presenting it linearly. -->
    <!-- Visualization & Content Choices: 1. Process Flow: HTML/CSS diagram to inform users of the overall structure. 2. Inventory Classification: Donut chart (Chart.js) to show proportions of transaction types; interactive buttons update a text block to explain the specific logic for each type. Goal: Organize & Inform. 3. Route Filtering: Bar chart (Chart.js) to compare total vs. productive routes; interactive checkboxes update the chart. Goal: Compare & Inform. 4. Personnel Classification: Stacked bar chart (Chart.js) to show breakdown of hours. Goal: Compare. All charts use Canvas. Textual logic is displayed dynamically to avoid overwhelming the user. CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
            color: #1e293b; /* slate-800 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .flow-arrow {
            position: relative;
        }
        .flow-arrow::after {
            content: '‚Üí';
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            color: #64748b; /* slate-500 */
        }
        .flow-arrow-down::after {
            content: '‚Üì';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            color: #64748b; /* slate-500 */
        }
        .active-tab {
            background-color: #0ea5e9; /* sky-500 */
            color: white;
            border-color: #0ea5e9;
        }
        .inactive-tab {
            background-color: white;
            color: #334155; /* slate-700 */
        }
        .active-pill {
            background-color: #38bdf8; /* sky-400 */
            color: white;
        }
        .inactive-pill {
            background-color: #e2e8f0; /* slate-200 */
            color: #475569; /* slate-600 */
        }
        .table-container {
            max-height: 400px;
            overflow-y: auto;
        }
        .transaction-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .code-block {
            background-color: #1e293b; /* slate-800 */
            color: #e2e8f0; /* slate-200 */
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.8rem;
            line-height: 1.5;
            overflow-x: auto;
            max-height: 500px;
        }
        .flow-line {
            width: 2px;
            background-color: #cbd5e1; /* slate-300 */
        }
        .flow-connector {
            position: relative;
        }
        .flow-connector::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -32px; /* Adjust based on padding and gap */
            width: 32px;
            height: 2px;
            background-color: #cbd5e1;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <h1 class="text-2xl md:text-3xl font-bold text-sky-600 text-center">Explorador Interactivo del Script de Productividad</h1>
            <p class="text-center text-slate-500 mt-1">Un an√°lisis visual de la l√≥gica de negocio en Qlik</p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">

        <section id="exploration" class="mb-16">
            <h2 class="text-2xl font-bold text-slate-700 mb-2 text-center">An√°lisis Detallado del Proceso</h2>
            <p class="text-center text-slate-600 mb-8 max-w-3xl mx-auto">Navegue por las pesta√±as para entender cada componente del script: c√≥mo se clasifica cada transacci√≥n, las reglas por sucursal y qui√©nes son excluidos del c√°lculo.</p>
            
            <div class="flex justify-center mb-8">
                <div class="flex flex-wrap justify-center gap-2 p-1 bg-slate-200 rounded-full" id="exploration-tabs">
                    <button data-tab="flowchart" class="px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 active-tab">Flujograma del Proceso</button>
                    <button data-tab="logic" class="px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 inactive-tab">L√≥gica del Script</button>
                    <button data-tab="warehouses" class="px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 inactive-tab">An√°lisis de Almacenes</button>
                    <button data-tab="transactions" class="px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 inactive-tab">Glosario de Transacciones</button>
                    <button data-tab="full-code" class="px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 inactive-tab">C√≥digo y Anotaciones</button>
                </div>
            </div>

            <div id="tab-content">
                <!-- Tab 1: Flowchart -->
                <div id="flowchart-content">
                    <h3 class="font-bold text-xl text-slate-700 mb-3 text-center">Flujograma: De Datos Crudos a Indicador de Productividad</h3>
                    <p class="text-slate-600 mb-12 text-center max-w-3xl mx-auto">
                        Este diagrama visualiza el viaje completo de los datos. Muestra c√≥mo las tres fuentes de datos principales son procesadas en paralelo y luego consolidadas para generar el indicador final de Kg / Hora-Hombre.
                    </p>
                    <div class="grid lg:grid-cols-3 gap-8">
                        <!-- Column 1: Almac√©n / Despacho -->
                        <div class="space-y-4">
                            <h4 class="font-bold text-lg text-center text-sky-700">√Årea de Almac√©n y Despacho</h4>
                            <div class="bg-white p-4 rounded-lg shadow border border-slate-200">
                                <p class="font-semibold">1. Carga de Datos Crudos</p>
                                <p class="text-sm text-slate-500">Se cargan y unifican los QVDs de movimientos de inventario (actual e hist√≥ricos).</p>
                            </div>
                            <div class="text-center text-2xl text-slate-400">‚Üì</div>
                            <div class="bg-white p-4 rounded-lg shadow border border-slate-200">
                                <p class="font-semibold">2. Enriquecimiento con Maestros</p>
                                <p class="text-sm text-slate-500">Se cruza la informaci√≥n con el `Maestro_Almacenes` para a√±adir detalles como la sucursal.</p>
                            </div>
                            <div class="text-center text-2xl text-slate-400">‚Üì</div>
                             <div class="bg-white p-4 rounded-lg shadow border border-slate-200">
                                <p class="font-semibold">3. Clasificaci√≥n de Operaciones</p>
                                <p class="text-sm text-slate-500">Paso CR√çTICO: Se aplica la l√≥gica de `IFs` para asignar un `TIPO_OPERACION` (Venta, Recepci√≥n, etc.) a cada transacci√≥n.</p>
                            </div>
                             <div class="text-center text-2xl text-slate-400">‚Üì</div>
                             <div class="bg-green-100 p-4 rounded-lg shadow border border-green-300">
                                <p class="font-semibold text-green-800">Resultado: Tabla `Movimientos_Inv`</p>
                                <p class="text-sm text-green-700">Una tabla limpia con todos los Kilos movidos, clasificados por operaci√≥n productiva.</p>
                            </div>
                        </div>
                        <!-- Column 2: Transporte -->
                        <div class="space-y-4">
                            <h4 class="font-bold text-lg text-center text-sky-700">√Årea de Transporte</h4>
                            <div class="bg-white p-4 rounded-lg shadow border border-slate-200">
                                <p class="font-semibold">1. Carga de Datos de Rutas</p>
                                <p class="text-sm text-slate-500">Se cargan y unifican los QVDs de rutas de Greenmile (actual e hist√≥ricos).</p>
                            </div>
                            <div class="text-center text-2xl text-slate-400">‚Üì</div>
                            <div class="bg-white p-4 rounded-lg shadow border border-slate-200">
                                <p class="font-semibold">2. Filtrado de Rutas</p>
                                <p class="text-sm text-slate-500">Se aplican filtros para excluir rutas de prueba, d√≠as de contingencia e inconsistencias.</p>
                            </div>
                            <div class="text-center text-2xl text-slate-400">‚Üì</div>
                             <div class="bg-white p-4 rounded-lg shadow border border-slate-200">
                                <p class="font-semibold">3. Cruce con Despacho</p>
                                <p class="text-sm text-slate-500">Se une con los datos de `Despacho y Transporte` para obtener el `TIPO_VIAJE` y el `DISTRIBUIDOR`.</p>
                            </div>
                             <div class="text-center text-2xl text-slate-400">‚Üì</div>
                             <div class="bg-green-100 p-4 rounded-lg shadow border border-green-300">
                                <p class="font-semibold text-green-800">Resultado: Tabla `Rutas_Paradas`</p>
                                <p class="text-sm text-green-700">Una tabla limpia con todas las rutas y paradas v√°lidas para medir la productividad.</p>
                            </div>
                        </div>
                        <!-- Column 3: Personal -->
                        <div class="space-y-4">
                            <h4 class="font-bold text-lg text-center text-sky-700">√Årea de Personal</h4>
                            <div class="bg-white p-4 rounded-lg shadow border border-slate-200">
                                <p class="font-semibold">1. Carga de Datos de RRHH</p>
                                <p class="text-sm text-slate-500">Se carga el archivo TR4 con el registro de horas trabajadas de todo el personal.</p>
                            </div>
                            <div class="text-center text-2xl text-slate-400">‚Üì</div>
                            <div class="bg-white p-4 rounded-lg shadow border border-slate-200">
                                <p class="font-semibold">2. Identificaci√≥n de Excepciones</p>
                                <p class="text-sm text-slate-500">Se aplican las reglas para marcar al personal `REUBICADO` o en `SINDICATO`.</p>
                            </div>
                            <div class="text-center text-2xl text-slate-400">‚Üì</div>
                             <div class="bg-white p-4 rounded-lg shadow border border-slate-200">
                                <p class="font-semibold">3. Agrupaci√≥n de √Åreas</p>
                                <p class="text-sm text-slate-500">Se crea el campo `AREA_2` para agrupar al personal en Despacho, Transporte y Staff.</p>
                            </div>
                             <div class="text-center text-2xl text-slate-400">‚Üì</div>
                             <div class="bg-green-100 p-4 rounded-lg shadow border border-green-300">
                                <p class="font-semibold text-green-800">Resultado: Tabla `FINAL_TR4_2`</p>
                                <p class="text-sm text-green-700">Una tabla con las horas trabajadas, donde el personal no productivo est√° claramente identificado.</p>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-center my-8">
                        <div class="text-4xl text-slate-400">‚Üì</div>
                    </div>

                    <div class="bg-sky-100 p-6 rounded-lg shadow-lg border-2 border-dashed border-sky-400">
                        <h4 class="font-bold text-xl text-center text-sky-800">Consolidaci√≥n Final</h4>
                        <div class="grid md:grid-cols-3 gap-4 mt-4 text-center">
                            <div class="bg-white p-3 rounded-md shadow-sm">
                                <p class="font-semibold">Kilos Movidos</p>
                                <p class="text-sm text-slate-500">De `Movimientos_Inv`</p>
                            </div>
                            <div class="flex items-center justify-center text-2xl font-bold text-slate-500">+</div>
                            <div class="bg-white p-3 rounded-md shadow-sm">
                                <p class="font-semibold">Horas Productivas</p>
                                <p class="text-sm text-slate-500">De `FINAL_TR4_2` (filtrado)</p>
                            </div>
                        </div>
                        <div class="text-center text-2xl text-slate-400 my-4">‚Üì</div>
                        <div class="bg-green-500 text-white p-4 rounded-lg shadow-xl text-center">
                            <h5 class="text-2xl font-bold">Indicador de Productividad Final</h5>
                            <p>Kg Movidos / Horas-Hombre</p>
                        </div>
                    </div>
                </div>
                
                <!-- Tab 2: Script Logic -->
                <div id="logic-content" class="hidden">
                    <div class="flex justify-center mb-6">
                         <div class="flex space-x-2 p-1 bg-white rounded-full border shadow-sm" id="logic-pills">
                            <button data-logic="inventory" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 active-pill">Clasificaci√≥n de Operaciones</button>
                            <button data-logic="branch" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 inactive-pill">L√≥gica por Sucursal</button>
                            <button data-logic="personnel" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 inactive-pill">Reglas de Personal</button>
                        </div>
                    </div>
                    
                    <div id="logic-details-content">
                        <!-- Inventory Logic -->
                        <div id="inventory-logic-content">
                             <div class="grid md:grid-cols-2 gap-8 items-center">
                                <div>
                                    <h3 class="font-bold text-xl text-slate-700 mb-3">¬øC√≥mo sabe el sistema qu√© es cada movimiento?</h3>
                                    <p class="text-slate-600 mb-4">
                                        El paso m√°s cr√≠tico es asignar cada transacci√≥n a un **Tipo de Operaci√≥n**. Esto permite medir √∫nicamente los movimientos que generan productividad. Seleccione un tipo de operaci√≥n para ver la l√≥gica de Qlik que se aplica.
                                    </p>
                                    <div class="flex flex-wrap gap-2 mb-4" id="inventory-op-pills">
                                        <button data-op="RECEPCIONES" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 active-pill">Recepciones</button>
                                        <button data-op="VENTAS" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 inactive-pill">Ventas</button>
                                        <button data-op="ENVIOS" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 inactive-pill">Env√≠os</button>
                                        <button data-op="DEVOLUCIONES" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 inactive-pill">Devoluciones</button>
                                        <button data-op="SALIDAS_A_SAP" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 inactive-pill">Salidas a SAP</button>
                                    </div>
                                    <div class="bg-slate-800 text-white p-4 rounded-lg font-mono text-xs overflow-x-auto">
                                        <pre><code id="inventory-logic-code"></code></pre>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="inventoryChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <!-- Branch Logic -->
                        <div id="branch-logic-content" class="hidden">
                             <h3 class="font-bold text-xl text-slate-700 mb-3 text-center">¬øPor qu√© cada sucursal tiene reglas diferentes?</h3>
                             <p class="text-center text-slate-600 mb-8 max-w-3xl mx-auto">Una de las mayores complejidades del script es la identificaci√≥n de transporte tercerizado, ya que la forma de registrarlo no es la misma en todas partes. Explore las particularidades de cada sucursal.</p>
                            <div class="flex justify-center mb-8">
                                <div class="flex space-x-2 p-1 bg-slate-200 rounded-full" id="branch-tabs">
                                    <button data-branch="SCZ" class="px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 active-tab">Santa Cruz (SCZ)</button>
                                    <button data-branch="LPZ" class="px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 inactive-tab">La Paz (LPZ)</button>
                                    <button data-branch="CBBA" class="px-4 py-2 text-sm font-semibold rounded-full transition-colors duration-300 inactive-tab">Cochabamba (CBBA)</button>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-lg border border-slate-200 max-w-4xl mx-auto">
                                <h4 class="font-bold text-lg text-slate-800 mb-2" id="branch-title"></h4>
                                <div class="text-slate-600 mb-4 space-y-3" id="branch-description"></div>
                                <div class="mt-6">
                                    <h5 class="font-semibold text-sm text-slate-500 mb-2">Fragmento de C√≥digo de Referencia:</h5>
                                    <div class="bg-slate-800 text-white p-4 rounded-lg font-mono text-xs overflow-x-auto">
                                        <pre><code id="branch-logic-code"></code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Personnel Logic -->
                        <div id="personnel-logic-content" class="hidden">
                            <h3 class="font-bold text-xl text-slate-700 mb-3 text-center">¬øLas horas de qui√©nes se excluyen del c√°lculo?</h3>
                            <p class="text-slate-600 mb-8 text-center max-w-3xl mx-auto">
                                Para calcular la productividad real, necesitamos saber qu√© horas de trabajo cuentan y cu√°les no. El script usa "listas especiales" para excluir las horas de personas que no estaban haciendo trabajo operativo.
                            </p>
                            <div class="flex justify-center mb-6">
                                 <div class="flex space-x-2 p-1 bg-slate-200 rounded-full" id="personnel-pills">
                                    <button data-personnel="reubicados" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 active-pill">üßë‚Äçüîß Reubicados</button>
                                    <button data-personnel="sindicato" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 inactive-pill">‚úä Sindicato</button>
                                    <button data-personnel="especiales" class="px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 inactive-pill">‚≠ê Otras Asignaciones</button>
                                </div>
                            </div>
                            <div id="personnel-details-content" class="grid lg:grid-cols-5 gap-8">
                                <div class="lg:col-span-3 bg-white p-6 rounded-lg shadow-lg border border-slate-200">
                                    <h4 id="personnel-title" class="font-bold text-lg text-slate-800 mb-2"></h4>
                                    <p id="personnel-description" class="text-slate-600 mb-4"></p>
                                    <div class="table-container border border-slate-200 rounded-md">
                                        <table class="w-full text-sm text-left">
                                            <thead class="bg-slate-100 text-xs text-slate-700 uppercase sticky top-0">
                                                <tr>
                                                    <th scope="col" class="px-4 py-3">ID Empleado</th>
                                                    <th scope="col" class="px-4 py-3">Condici√≥n</th>
                                                    <th scope="col" class="px-4 py-3">Suc.</th>
                                                    <th scope="col" class="px-4 py-3">Comentarios del Script</th>
                                                </tr>
                                            </thead>
                                            <tbody id="personnel-table-body" class="divide-y divide-slate-200">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="lg:col-span-2 chart-container self-center">
                                    <canvas id="personnelChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab 2: Data Explorer - Warehouses -->
                <div id="warehouses-content" class="hidden">
                    <h3 class="font-bold text-xl text-slate-700 mb-3 text-center">An√°lisis de Almacenes y Transferencias</h3>
                    <p class="text-slate-600 mb-8 text-center max-w-3xl mx-auto">
                        El maestro de almacenes nos permite entender el rol de cada ubicaci√≥n. Aqu√≠ podemos ver c√≥mo interact√∫an y qu√© transacciones son vitales para la operaci√≥n entre ellos.
                    </p>
                    <div class="bg-white p-6 rounded-lg shadow-lg border border-slate-200 mb-8">
                        <h4 class="font-bold text-lg text-slate-800 mb-4">Anatom√≠a de las Transferencias y Movimientos Clave</h4>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="border border-slate-200 p-4 rounded-lg bg-slate-50">
                                <h5 class="font-semibold text-slate-700">Transferencia entre Organizaciones</h5>
                                <p class="text-sm text-slate-600">Mueve producto entre dos "organizaciones" o centros de distribuci√≥n principales. Es una operaci√≥n log√≠stica clave para balancear inventario a nivel nacional.</p>
                                <div class="mt-2 text-center p-2 bg-white rounded-md border">
                                    <div class="font-semibold">CD SCZ (C43) ‚ûî CD LPZ (C42)</div>
                                    <div class="text-xs text-slate-500">TIPO_TRANS: `Direct Org Transfer`, `Transferencia Org 2 Pasos`</div>
                                </div>
                            </div>
                            <div class="border border-slate-200 p-4 rounded-lg bg-slate-50">
                                <h5 class="font-semibold text-slate-700">Transferencia Interna de CD</h5>
                                <p class="text-sm text-slate-600">Mueve producto DENTRO del mismo CD. No sale del edificio, solo cambia de √°rea (ej: de recepci√≥n a picking).</p>
                                <div class="mt-2 text-center p-2 bg-white rounded-md border">
                                    <div class="font-semibold">Dentro de CD SCZ (C43): √Årea '07' ‚ûî √Årea '01'</div>
                                    <div class="text-xs text-slate-500">TIPO_TRANS: `Subinventory Transfer`, `Move Order Transfer`</div>
                                </div>
                            </div>
                            <div class="border border-slate-200 p-4 rounded-lg bg-slate-50">
                                <h5 class="font-semibold text-slate-700">Abastecimiento a Almacenes Secundarios</h5>
                                <p class="text-sm text-slate-600">Es la salida de un CD principal para abastecer a otro almac√©n de la red, como una agencia comercial o un CD regional.</p>
                                <div class="mt-2 text-center p-2 bg-white rounded-md border">
                                    <div class="font-semibold">CD SCZ (C43) ‚ûî Agencia Grigota (A01)</div>
                                    <div class="text-xs text-slate-500">TIPO_TRANS: `Int Order Intr Ship`</div>
                                </div>
                            </div>
                            <div class="border border-slate-200 p-4 rounded-lg bg-slate-50">
                                <h5 class="font-semibold text-slate-700">Recepci√≥n de Mercader√≠a Externa</h5>
                                <p class="text-sm text-slate-600">Ingreso de producto desde un proveedor externo (una compra) o la devoluci√≥n de un cliente.</p>
                                <div class="mt-2 text-center p-2 bg-white rounded-md border">
                                    <div class="font-semibold">Proveedor ‚ûî CD CBBA (C31)</div>
                                    <div class="text-xs text-slate-500">TIPO_TRANS: `PO Receipt`, `RMA Receipt`</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h4 class="font-bold text-lg text-slate-800 mb-4 text-center">Glosario de Almacenes</h4>
                    <div class="mb-6 max-w-4xl mx-auto grid sm:grid-cols-3 gap-4">
                        <div>
                            <label for="warehouse-filter-suc" class="block text-sm font-medium text-slate-700">Filtrar por Sucursal</label>
                            <select id="warehouse-filter-suc" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm rounded-md"></select>
                        </div>
                        <div>
                            <label for="warehouse-filter-group" class="block text-sm font-medium text-slate-700">Filtrar por Grupo</label>
                            <select id="warehouse-filter-group" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm rounded-md"></select>
                        </div>
                         <div>
                            <label for="warehouse-search" class="block text-sm font-medium text-slate-700">Buscar por Nombre o C√≥digo</label>
                            <input type="text" id="warehouse-search" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm rounded-md" placeholder="Ej: Grigota o A01">
                        </div>
                    </div>
                    <div id="warehouse-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Warehouse cards will be injected here -->
                    </div>
                </div>
                
                <!-- Tab 3: Transactions Glossary -->
                <div id="transactions-content" class="hidden">
                     <h4 class="font-bold text-xl text-slate-700 mb-4 text-center">Glosario Interactivo de Transacciones</h4>
                     <p class="text-slate-600 mb-8 text-center max-w-3xl mx-auto">
                        Aqu√≠ puedes explorar cada tipo de transacci√≥n que existe en el sistema. Usa los filtros para encontrar r√°pidamente lo que buscas y entender qu√© hace cada una y c√≥mo la interpreta el script.
                    </p>
                    <div class="mb-6 max-w-4xl mx-auto flex flex-col sm:flex-row gap-4">
                        <div class="flex-1">
                            <label for="transaction-filter-group" class="block text-sm font-medium text-slate-700">Filtrar por Grupo</label>
                            <select id="transaction-filter-group" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm rounded-md">
                                <option value="Todos">Todos los Grupos</option>
                                <option value="SAP">SAP</option>
                                <option value="Centros de Distribuci√≥n">Centros de Distribuci√≥n</option>
                            </select>
                        </div>
                         <div class="flex-1">
                            <label for="transaction-search" class="block text-sm font-medium text-slate-700">Buscar por Nombre</label>
                            <input type="text" id="transaction-search" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm rounded-md" placeholder="Ej: Sales order issue">
                        </div>
                    </div>
                    <div id="transaction-container" class="space-y-4">
                        <!-- Transaction cards will be injected here -->
                    </div>
                </div>

                <!-- Tab 4: Full Code -->
                <div id="full-code-content" class="hidden">
                    <h3 class="font-bold text-xl text-slate-700 mb-3 text-center">C√≥digo Completo del Script y Anotaciones</h3>
                    <p class="text-slate-600 mb-8 text-center max-w-3xl mx-auto">
                        Aqu√≠ puedes revisar el script original completo. Utiliza el √°rea de texto al final para registrar tus notas, correcciones o ideas de mejora durante la sesi√≥n de trabajo.
                    </p>
                    
                    <div class="space-y-8">
                        <div>
                            <h4 class="font-semibold text-lg text-slate-700 mb-2 border-b-2 border-sky-500 pb-1">1. C√≥digo de Movimientos y Transacciones</h4>
                            <pre class="code-block"><code>//// C√ìDIGO DE MOVIMIENTOS Y TRANSACCIONES ////
AUXMovimientos_Inv1:
NoConcatenate
LOAD ...
FROM [lib://.../Movimientos_GestionActual.qvd](qvd);

Concatenate (AUXMovimientos_Inv1)
LOAD ...
FROM [lib://.../Movimientos_Gestion2022-2023.qvd](qvd);

Concatenate (AUXMovimientos_Inv1)
LOAD ...
FROM [lib://.../Movimientos_GestionAnterior.qvd](qvd);
 
LEFT JOIN(AUXMovimientos_Inv1)
LOAD ...
FROM [lib://.../Maestro_Almacenes.qvd](qvd);

AUXMovimientos_Inv:
LOAD ...
IF(MATCH (TIPO_TRANS,'Transferencia SubInv Directa') ... ,'RECEPCIONES',
...
) AS TIPO_OPERACION,
...
RESIDENT AUXMovimientos_Inv1;
DROP TABLE AUXMovimientos_Inv1;

LEFT JOIN (AUXMovimientos_Inv)
LOAD ...
FROM [lib://.../AGRUPADOR PERIODOS TR4.xlsx](ooxml, embedded labels, table is Sheet1);

LEFT JOIN(AUXMovimientos_Inv)
LOAD ...
FROM [lib://.../Maestro_Clientes.qvd](qvd);

Movimientos_Inv:
NoConcatenate
LOAD ...
IF(Match(INVENTORY_ITEM_ID, ...),CANTIDAD_UNIDADES*Peso,CANTIDAD_KGS) as CANTIDAD_KGS,
...
Resident AUXMovimientos_Inv;
DROP TABLE AUXMovimientos_Inv;</code></pre>
                        </div>

                        <div>
                            <h4 class="font-semibold text-lg text-slate-700 mb-2 border-b-2 border-sky-500 pb-1">2. C√≥digo de Transporte y Entrega de Pedidos</h4>
                            <pre class="code-block"><code>//// C√ìDIGO DE TRANSPORTE Y ENTREGA DE PEDIDOS ////
AUXRutas_Paradas_0:
NoConcatenate
LOAD ...
FROM [lib://.../RutasGM_Gestion2022-2023.qvd](qvd);

Concatenate(AUXRutas_Paradas_0)
LOAD ...
FROM [lib://.../RutasGM_GestionAnterior.qvd](qvd);

Concatenate (AUXRutas_Paradas_0)
LOAD ...
FROM [lib://.../RutasGM_GestionActual.qvd](qvd);

AUXRutas_Paradas:
NoConcatenate
LOAD *
RESIDENT AUXRutas_Paradas_0
WHERE ...;
DROP TABLE AUXRutas_Paradas_0;

Left Join (AUXRutas_Paradas)
LOAD ...
FROM [lib://.../No_considerar_GM.xlsx](ooxml, embedded labels, table is FechasNOCONSIDERAR);

DP:
NoConcatenate
LOAD Distinct ...
FROM [lib://.../Desp_transp_GestionActual.qvd](qvd);

... (Concatenates para DP) ...

LEFT JOIN (AUXRutas_Paradas)
load Distinct ...
Resident DP;
DROP TABLE DP;

NoConcatenate
Rutas_Paradas:
LOAD ...
Resident AUXRutas_Paradas
where ...;
Drop Table AUXRutas_Paradas;

PERIODO_TR4:
LOAD ...
FROM [lib://.../AGRUPADOR PERIODOS TR4.xlsx](ooxml, embedded labels, table is Sheet1);

LEFT JOIN (Rutas_Paradas)
LOAD ...
Resident PERIODO_TR4;
drop table PERIODO_TR4;</code></pre>
                        </div>

                        <div>
                            <h4 class="font-semibold text-lg text-slate-700 mb-2 border-b-2 border-sky-500 pb-1">3. C√≥digo de Consolidaci√≥n Final</h4>
                             <pre class="code-block"><code>//////////////////C√ìDIGO DE REUBICADOS (NO APORTAN PRODUCTIVIDAD) Y SINDICATOS (ALGUNOS NO APORTAN)/////////////////////////////////////////////////////////////////////////////////////
Consolidado:
NoConcatenate
LOAD ...
'Transacciones' AS FLAG,
...
resident Movimientos_Inv;

Concatenate (Consolidado)
LOAD ...
'Greenmile' AS FLAG,
...
If(Match([r.conductorPrincipal]&'-'&SubField([r.codigoRuta],'-',3)&'-'&TIPO_VIAJE_DP,...),'TERCIARIO',
...
) AS TIPO_CONDUCTOR,
...
Resident Rutas_Paradas;

FINAL_TR4:
NoConcatenate
LOAD ...
IF(Match(ID_EMPLEADO,...),'ALMACEN.SECOS.SCZ-DIST-%',...) AS SECCION,
...
IF(ID_EMPLEADO='617' AND FECHA_PROCESO >= DATE('01/10/2023','dd/mm/yyyy'), 'REUBICADO' ,...) AS CONDICION_REUBICADO,
IF(ID_EMPLEADO='1116' AND FECHA_PROCESO >= DATE('01/09/2023','dd/mm/yyyy'), 'SINDICATO' ,...) AS CONDICION_SINDICATO
Resident TR4;

FINAL_TR4_2:
LOAD ...
IF(WildMatch(AREA,'*TRANSPOR*'),'TRANSPORTE',...) AS AREA_2
Resident FINAL_TR4;

drop tables Movimientos_Inv, Rutas_Paradas, TR4, FINAL_TR4;</code></pre>
                        </div>
                        
                        <div>
                             <h4 class="font-semibold text-lg text-slate-700 mb-2 border-b-2 border-amber-500 pb-1">üìù √Årea de Anotaciones y Comentarios</h4>
                             <textarea id="notes-area" class="w-full h-64 p-4 border border-slate-300 rounded-md focus:ring-sky-500 focus:border-sky-500" placeholder="Escribe aqu√≠ tus notas, correcciones o ideas durante la presentaci√≥n..."></textarea>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <hr class="my-12 border-slate-200">

        <section id="conclusion" class="text-center">
            <h2 class="text-2xl font-bold text-slate-700 mb-4">Conclusi√≥n y Desaf√≠os Clave</h2>
            <p class="max-w-3xl mx-auto text-slate-600 mb-8">
                El script actual es funcional pero presenta desaf√≠os importantes para su mantenimiento y escalabilidad. La precisi√≥n del indicador de productividad depende directamente de la actualizaci√≥n constante de estas reglas.
            </p>
            <div class="max-w-2xl mx-auto grid md:grid-cols-2 gap-6">
                <div class="bg-amber-100 border border-amber-300 p-4 rounded-lg">
                    <h3 class="font-semibold text-amber-800">Alta Dependencia de Valores Manuales</h3>
                    <p class="text-sm text-amber-700">El c√≥digo contiene listas de IDs de empleados, nombres de conductores y placas de veh√≠culos "quemados" (hardcoded). Cualquier cambio en el personal o la flota requiere una modificaci√≥n directa del script.</p>
                </div>
                <div class="bg-amber-100 border border-amber-300 p-4 rounded-lg">
                    <h3 class="font-semibold text-amber-800">Mantenimiento Constante</h3>
                    <p class="text-sm text-amber-700">Las fechas de contingencia y las condiciones especiales del personal deben ser a√±adidas manualmente. Esto representa un riesgo de que el c√°lculo se vuelva obsoleto o impreciso si no se actualiza a tiempo.</p>
                </div>
            </div>
             <p class="max-w-3xl mx-auto text-slate-600 mt-8">
                Una posible mejora a futuro ser√≠a externalizar estas reglas a archivos maestros o tablas de configuraci√≥n, facilitando su actualizaci√≥n sin necesidad de editar el c√≥digo fuente del script.
            </p>
        </section>

    </main>

    <footer class="bg-slate-800 text-slate-400 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 text-center text-sm">
            <p>Aplicaci√≥n Interactiva de An√°lisis de Script &copy; 2025</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const logicData = {
        inventory: {
            'RECEPCIONES': `Se clasifica como 'RECEPCIONES' si cumple CUALQUIERA de estas condiciones:
- TIPO_TRANS = 'Transferencia SubInv Directa' Y SUBINVENTORY = '07'
- TIPO_TRANS = 'TRANSACCIONES DE INGRESO' Y TIPO_ALIAS es 'INGIMP' o 'INGC'
- TIPO_TRANS = 'Transferencia Org 2 Pasos' o 'Intransit Receipt'
- ... y otras reglas de transferencias internas.`,
            'VENTAS': `Se clasifica como 'VENTAS' si:
- TIPO_TRANS = 'Sales order issue'
- Y ORGANIZATION_ID no es '366'`,
            'ENVIOS': `Se clasifica como 'ENVIOS' si:
- TIPO_TRANS = 'Int Order Intr Ship'
- Y ALMDESTINO pertenece a una lista espec√≠fica de almacenes comerciales.`,
            'DEVOLUCIONES': `Se clasifica como 'DEVOLUCIONES' si cumple CUALQUIERA de estas condiciones:
- TIPO_TRANS = 'RMA Receipt'
- TIPO_TRANS = 'TRANSACCIONES DE INGRESO' O 'SALIDA' Y TIPO_ALIAS = 'EDEV'
- TIPO_ALIAS = 'DSPCI' (Desarmado de Incentivos)`,
            'SALIDAS_A_SAP': `Se clasifica como 'SALIDA A SAP' si cumple CUALQUIERA de estas condiciones:
- TIPO_TRANS = 'Int Order Intr Ship' Y ALMDESTINO NO est√° en la lista de almacenes comerciales.
- TIPO_ALIAS = 'SPCI' (Armado de Incentivos para Despacho)`
        },
        branch: {
            'SCZ': {
                title: 'L√≥gica para Santa Cruz (SCZ) üå¥',
                description: `
                    <p>En Santa Cruz, la regla para saber si un cami√≥n es de un tercero es la m√°s estricta. Imagina que para abrir una caja fuerte necesitas una combinaci√≥n de <strong>TRES</strong> n√∫meros. Aqu√≠ es igual.</p>
                    <h4 class="font-semibold text-slate-700 mt-4 mb-2">üîç C√≥mo funciona la regla:</h4>
                    <ul>
                        <li>1. <strong>Se crea una "llave √∫nica" üîë:</strong> El sistema junta tres datos: el <strong>nombre del conductor</strong>, la <strong>placa del veh√≠culo</strong> y el <strong>tipo de viaje</strong> (ej: "RUTAS_H").</li>
                        <li>2. <strong>Se compara con una lista üìú:</strong> El sistema revisa si esa "llave √∫nica" exacta est√° en una lista especial de transportistas tercerizados conocidos.</li>
                        <li>3. <strong>Se toma una decisi√≥n ‚úÖ:</strong> Si la llave est√° en la lista, el viaje se marca como <strong>"TERCIARIO"</strong>. Si no, se considera de <strong>"SOFIA"</strong>.</li>
                    </ul>`,
                code: `If(Match([r.conductorPrincipal]&'-'&SubField([r.codigoRuta],'-',3)&'-'&TIPO_VIAJE_DP,
    'MONTA√ëO COLQUE, JESUS EDUARDO-3042AXK-RUTAS_H',
    'ALVARO MAGNE-4540TCA-SECOS',
    'NANCY GUTIERREZ MORALES-4821TUC-RUTAS_H',
    ...
),'TERCIARIO', ...)`
            },
            'LPZ': {
                title: 'L√≥gica para La Paz (LPZ) üèîÔ∏è',
                description: `
                    <p>En La Paz, la regla es un poco m√°s sencilla. Aqu√≠, la "caja fuerte" solo necesita una combinaci√≥n de <strong>DOS</strong> n√∫meros para abrirse.</p>
                    <h4 class="font-semibold text-slate-700 mt-4 mb-2">üîç C√≥mo funciona la regla:</h4>
                    <ul>
                        <li>1. <strong>Se crea una "llave" de dos partes üîë:</strong> El sistema junta el <strong>nombre del conductor</strong> y la <strong>placa del veh√≠culo</strong>.</li>
                        <li>2. <strong>Se compara con la lista pace√±a üìú:</strong> Revisa si esa combinaci√≥n de nombre y placa est√° en la lista de tercerizados de La Paz.</li>
                        <li>3. <strong>Se toma una decisi√≥n ‚úÖ:</strong> Si la combinaci√≥n est√° en la lista, se marca como <strong>"TERCIARIO"</strong>. De lo contrario, es de <strong>"SOFIA"</strong>.</li>
                    </ul>`,
                code: `If(Match([r.conductorPrincipal]&'-'&SubField([r.codigoRuta],'-',3),
    'ABEL MIXTO INGALI (TC-75820667)-4990TUE',
    'BORIS LAURA-6281CSC',
    'CLEMENTE APAZA-2472NPF',
    ...
),'TERCIARIO', ...)`
            },
            'CBBA': {
                title: 'L√≥gica para Cochabamba (CBBA) ‚òÄÔ∏è',
                description: `
                    <p>En Cochabamba, la regla se enfoca m√°s en el veh√≠culo y la misi√≥n que en qui√©n lo maneja. La combinaci√≥n para la "caja fuerte" es diferente.</p>
                    <h4 class="font-semibold text-slate-700 mt-4 mb-2">üîç C√≥mo funciona la regla:</h4>
                    <ul>
                        <li>1. <strong>Se crea una "llave" de veh√≠culo y misi√≥n üîë:</strong> El sistema junta la <strong>placa del veh√≠culo</strong> y el <strong>tipo de viaje</strong> (ej: "SECOS"). ¬°El nombre del conductor no importa aqu√≠!</li>
                        <li>2. <strong>Se compara con la lista cochabambina üìú:</strong> Revisa si esa combinaci√≥n de placa y tipo de viaje est√° en la lista de tercerizados de Cochabamba.</li>
                        <li>3. <strong>Se toma una decisi√≥n ‚úÖ:</strong> Si la combinaci√≥n est√° en la lista, se marca como <strong>"TERCIARIO"</strong>. Si no, es de <strong>"SOFIA"</strong>.</li>
                    </ul>`,
                code: `If(Match(SubField([r.codigoRuta],'-',3)& '-' &TIPO_VIAJE_DP,
    '6446BAC-SECOS',
    '6381USA-SECOS',
    '6238ZLN-SECOS',
    ...
), 'TERCIARIO', 'SOFIA')`
            }
        },
        personnel: {
            reubicados: {
                title: "üßë‚Äçüîß Personal Reubicado",
                description: "Son personas que, aunque forman parte de la empresa, fueron asignadas temporal o permanentemente a tareas que no se miden en la productividad del almac√©n. Sus horas se excluyen para no afectar el promedio.",
                data: [
                    { id: '617', condition: 'Desde 01/10/2023', branch: 'LPZ', comment: '' },
                    { id: '28168', condition: '01/01/2024 - 01/01/2025', branch: 'LPZ', comment: 'Fecha opcional, confirmar' },
                    { id: '11207', condition: '01/07/2022 - 01/01/2025', branch: 'LPZ', comment: '' },
                    { id: '19155', condition: 'Desde 01/01/2024', branch: 'CBBA', comment: '' },
                    { id: '22669', condition: 'Desde 01/12/2023', branch: 'SCZ', comment: '' },
                    { id: '13619', condition: 'Desde 01/04/2025', branch: 'SCZ', comment: 'Validaci√≥n Mensual' },
                    { id: '11777', condition: 'Permanente', branch: 'SCZ', comment: '' },
                    { id: '20223', condition: 'Desde 30/09/2023', branch: 'SCZ', comment: '' }
                ]
            },
            sindicato: {
                title: "‚úä Comisi√≥n Sindical",
                description: "Son personas que est√°n en comisi√≥n sindical. Por ley, su tiempo se dedica a actividades del sindicato, por lo que sus horas no se cuentan como trabajo operativo.",
                data: [
                    { id: '1116', condition: 'Desde 01/09/2023', branch: 'LPZ', comment: '' },
                    { id: '14364', condition: 'Desde 01/09/2021', branch: 'LPZ', comment: '' },
                    { id: '3292', condition: 'Desde 01/10/2023', branch: 'LPZ', comment: '' },
                    { id: '22798', condition: 'Excepci√≥n', branch: 'LPZ', comment: 'Sindicalista que s√≠ trabaja' },
                    { id: '8754', condition: 'Excepci√≥n', branch: 'SCZ', comment: 'Sindicalista que s√≠ trabaja' }
                ]
            },
            especiales: {
                title: "‚≠ê Otras Asignaciones Especiales",
                description: "Son casos particulares donde a una persona se le cambia su '√Årea' o 'Secci√≥n' directamente en el script para corregir o ajustar su registro en el sistema.",
                data: [
                    { id: '105', condition: "Secci√≥n -> 'ALMACEN.SECOS.SCZ'", branch: 'SCZ', comment: '¬øModificar historial?' },
                    { id: '16113', condition: "Secci√≥n -> 'ALMACEN.SECOS.SCZ'", branch: 'SCZ', comment: '¬øModificar historial?' },
                    { id: '20223', condition: "Secci√≥n -> 'ALMACENAJE HUEVO SCZ'", branch: 'SCZ', comment: 'Desde 30/09/2023' },
                    { id: 'Varios', condition: "√Årea -> 'STAFF GDN'", branch: 'Todas', comment: 'Aplica a todos los reubicados' }
                ]
            }
        },
        warehouses: [
            { ALMACEN: 'A01', ORGANIZATION_ID: 1024, ALMACEN_DESCRIPCION: 'A01: Almac√©n Micromercado Grigota - SCZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'SCZ.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A02', ORGANIZATION_ID: 1025, ALMACEN_DESCRIPCION: 'A02: Almac√©n Micromercado Grigota - SCZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'SCZ.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A03', ORGANIZATION_ID: 1865, ALMACEN_DESCRIPCION: 'A03: VENTAS MENORES SCZ PLAN 3000', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'SCZ.', Almacen_Agrupador: 'VENTAS MENORES' },
            { ALMACEN: 'A04', ORGANIZATION_ID: 1044, ALMACEN_DESCRIPCION: 'A04: Almac√©n Micromercado Mutualista - SCZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'SCZ.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A05', ORGANIZATION_ID: 1045, ALMACEN_DESCRIPCION: 'A05: Almac√©n Micromercado Santos Dumont - SCZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'SCZ.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A06', ORGANIZATION_ID: 1046, ALMACEN_DESCRIPCION: 'A06: Almac√©n Micromercado Pampa de la Isla - SCZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'SCZ.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A07', ORGANIZATION_ID: 1047, ALMACEN_DESCRIPCION: 'A07: Almac√©n Micromercado La Cuchilla - SCZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'SCZ.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A08', ORGANIZATION_ID: 1048, ALMACEN_DESCRIPCION: 'A08: Almac√©n Micromercado Virgen de Cotoca - SCZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'SCZ.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A09', ORGANIZATION_ID: 1049, ALMACEN_DESCRIPCION: 'A09: Almac√©n Micromercado Villa 1ro de Mayo - SCZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'SCZ.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A10', ORGANIZATION_ID: 1063, ALMACEN_DESCRIPCION: 'A10: Almac√©n Micromercado 2 de Agosto - LPZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'LP-EA.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A11', ORGANIZATION_ID: 1064, ALMACEN_DESCRIPCION: 'A11: Almac√©n Micromercado San Pedro - LPZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'LP-EA.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A12', ORGANIZATION_ID: 1065, ALMACEN_DESCRIPCION: 'A12: Almac√©n Micromercado Miraflores - LPZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'LP-EA.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A13', ORGANIZATION_ID: 1066, ALMACEN_DESCRIPCION: 'A13: Almac√©n Micromercado El Tejar - LPZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'LP-EA.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A14', ORGANIZATION_ID: 1067, ALMACEN_DESCRIPCION: 'A14: Almac√©n Micromercado Calacoto - LPZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'LP-EA.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A15', ORGANIZATION_ID: 1068, ALMACEN_DESCRIPCION: 'A15: Almac√©n Micromercado Ceja - LPZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'LP-EA.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A16', ORGANIZATION_ID: 1083, ALMACEN_DESCRIPCION: 'A16: Almac√©n Micromercado Quillacollo - CBBA', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'CBBA.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A17', ORGANIZATION_ID: 1084, ALMACEN_DESCRIPCION: 'A17: Almac√©n Micromercado Am√©rica - CBBA', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'CBBA.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A18', ORGANIZATION_ID: 1085, ALMACEN_DESCRIPCION: 'A18: Almac√©n Micromercado Sacaba - CBBA', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'CBBA.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'A19', ORGANIZATION_ID: 1086, ALMACEN_DESCRIPCION: 'A19: Almac√©n Micromercado Aroma - CBBA', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'CBBA.', Almacen_Agrupador: 'SOFIA AL PASO' },
            { ALMACEN: 'C01', ORGANIZATION_ID: 363, ALMACEN_DESCRIPCION: 'C01: Almac√©n de F√°brica', GRUPO_ORGANIZACIONES: 'PRODUCCION', SUC: 'SCZ.', Almacen_Agrupador: 'PRODUCCION' },
            { ALMACEN: 'C31', ORGANIZATION_ID: 380, ALMACEN_DESCRIPCION: 'C31: Centro de Distribuci√≥n CBBA', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'CBBA.', Almacen_Agrupador: 'CD' },
            { ALMACEN: 'C42', ORGANIZATION_ID: 365, ALMACEN_DESCRIPCION: 'C42: Centro de Distribuci√≥n LPZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'LP-EA.', Almacen_Agrupador: 'CD' },
            { ALMACEN: 'C43', ORGANIZATION_ID: 1645, ALMACEN_DESCRIPCION: 'C43: Centro de Distribuci√≥n SCZ', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'SCZ.', Almacen_Agrupador: 'CD' },
            { ALMACEN: 'P24', ORGANIZATION_ID: 364, ALMACEN_DESCRIPCION: 'P24: Almac√©n de Producci√≥n', GRUPO_ORGANIZACIONES: 'PRODUCCION', SUC: 'SCZ.', Almacen_Agrupador: 'PRODUCCION' },
            { ALMACEN: 'C10', ORGANIZATION_ID: 1103, ALMACEN_DESCRIPCION: 'C10: CD Tarija', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'TJA.', Almacen_Agrupador: 'CD' },
            { ALMACEN: 'C20', ORGANIZATION_ID: 4565, ALMACEN_DESCRIPCION: 'C20: CD Sucre', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'SUC.', Almacen_Agrupador: 'CD' },
            { ALMACEN: 'C40', ORGANIZATION_ID: 4585, ALMACEN_DESCRIPCION: 'C40: CD Potosi', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'PSI.', Almacen_Agrupador: 'CD' },
            { ALMACEN: 'C41', ORGANIZATION_ID: 4685, ALMACEN_DESCRIPCION: 'C41: CD El Alto', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'LP-EA.', Almacen_Agrupador: 'CD' },
            { ALMACEN: 'W04', ORGANIZATION_ID: 1799, ALMACEN_DESCRIPCION: 'W04: CD Warnes', GRUPO_ORGANIZACIONES: 'DISTRIBUCION', SUC: 'SCZ.', Almacen_Agrupador: 'CD' }
        ],
        transactions: [
            { group: 'SAP', type: 'Direct Org Transfer', alias: false, detail: 'Transferencia directa entre organizaciones', origin: 'Personal de SAP', script_usage: 'Clasificado como RECEPCIONES en el almac√©n destino.' },
            { group: 'SAP', type: 'Int Req Intr Rcpt', alias: false, detail: 'Recepci√≥n de pedido interno de abastecimiento', origin: 'Personal de SAP', script_usage: 'Clasificado como RECEPCIONES. Es la confirmaci√≥n de un `Int Order Intr Ship`.' },
            { group: 'SAP', type: 'Intransit Receipt', alias: false, detail: 'Recepci√≥n de transferencia en dos pasos', origin: 'Personal de SAP', script_usage: 'Clasificado como RECEPCIONES. Es el segundo paso de una `Transferencia Org 2 Pasos`.' },
            { group: 'SAP', type: 'Miscellaneous issue', alias: true, detail: 'Salida miscel√°nea, normalmente, ventas (alias VMEN, VSOM, CONS, VBILL)', origin: 'EBS - Venta directa en SAP', script_usage: 'No se clasifica directamente, depende del TIPO_ALIAS para su interpretaci√≥n.' },
            { group: 'SAP', type: 'Miscellaneous receipt', alias: true, detail: 'Ingreso miscel√°neo, normalmente, anulaci√≥n de ventas (alias VMEN, VSOM, CONS, VBILL)', origin: 'EBS - Reversi√≥n de venta dentro de los 5 mins en SAP', script_usage: 'No se clasifica directamente, depende del TIPO_ALIAS.' },
            { group: 'SAP', type: 'PO Receipt', alias: false, detail: 'Recepci√≥n de OC', origin: 'Personal de SAP', script_usage: 'Clasificado como COMPRAS - IMPORTACIONES.' },
            { group: 'SAP', type: 'Residual Qty issue', alias: false, detail: 'Ajuste de salida autom√°tico de sistema, CANTIDAD RESIDUAL', origin: 'EBS', script_usage: 'No se considera para la productividad.' },
            { group: 'SAP', type: 'Residual Qty Receipt', alias: false, detail: 'Ajuste de ingreso autom√°tico de sistema, CANTIDAD RESIDUAL', origin: 'EBS', script_usage: 'No se considera para la productividad.' },
            { group: 'SAP', type: 'Return to Vendor', alias: false, detail: 'Reversi√≥n de OC', origin: 'Personal de SAP', script_usage: 'Clasificado como COMPRAS - IMPORTACIONES.' },
            { group: 'SAP', type: 'TRANSACCIONES DE INGRESO', alias: true, detail: 'Transacci√≥n Manual de Ingreso con motivo alias', origin: 'Operadores por solicitud de SAP', script_usage: 'Clave. Se usa para clasificar RECEPCIONES (alias INGC, INGIMP, DIFR) y DEVOLUCIONES (alias EDEV).' },
            { group: 'SAP', type: 'TRANSACCIONES DE SALIDA', alias: true, detail: 'Transacci√≥n Manual de Salida con motivo alias', origin: 'Operadores por solicitud de SAP', script_usage: 'Clave. Se usa para clasificar RECEPCIONES (alias INGC, INGIMP, DIFR) y DEVOLUCIONES (alias EDEV).' },
            { group: 'SAP', type: 'Transferencia Org 2 Pasos', alias: true, detail: 'Transferencia en dos pasos', origin: 'Operadores por solicitud de SAP', script_usage: 'Clasificado como RECEPCIONES en el almac√©n destino.' },
            { group: 'Centros de Distribuci√≥n', type: 'Account alias issue', alias: true, detail: 'Transacci√≥n de salida POR DISPOSITIVO (alias ALEE, AASB, DIF, DICC, TRCC, TRLT, etc)', origin: 'Pantalla de TELNET o DISPOSITIVO', script_usage: 'Depende del TIPO_ALIAS para su clasificaci√≥n (ej: DIFR -> RECEPCIONES).' },
            { group: 'Centros de Distribuci√≥n', type: 'Account alias receipt', alias: true, detail: 'Transacci√≥n de ingreso POR DISPOSITIVO (alias ALEE, AASB, DIF, DIFI, MERN, etc)', origin: 'Pantalla de TELNET o DISPOSITIVO', script_usage: 'Depende del TIPO_ALIAS para su clasificaci√≥n (ej: DIFR -> RECEPCIONES).' },
            { group: 'Centros de Distribuci√≥n', type: 'Container Pack', alias: false, detail: 'Embalado en LPN (W04)', origin: 'Pantalla de TELNET o DISPOSITIVO', script_usage: 'No se considera directamente, es un paso intermedio.' },
            { group: 'Centros de Distribuci√≥n', type: 'Container Split', alias: false, detail: 'Fraccionado de un LPN (W04)', origin: 'Pantalla de TELNET o DISPOSITIVO', script_usage: 'No se considera directamente, es un paso intermedio.' },
            { group: 'Centros de Distribuci√≥n', type: 'Container Unpack', alias: false, detail: 'Desembalado de LPN (W04)', origin: 'Pantalla de TELNET o DISPOSITIVO', script_usage: 'No se considera directamente, es un paso intermedio.' },
            { group: 'Centros de Distribuci√≥n', type: 'Direct Org Transfer', alias: false, detail: 'Transferencia directa entre organizaciones', origin: 'Operadores o DP', script_usage: 'Clasificado como RECEPCIONES en el almac√©n destino.' },
            { group: 'Centros de Distribuci√≥n', type: 'Int Order Intr Ship', alias: false, detail: 'Salida de CD por pedido interno de abastecimiento', origin: 'Movimiento de abastecimiento', script_usage: 'Fundamental. Se clasifica como ENVIOS si el destino es un almac√©n comercial, o como SALIDA A SAP si no lo es.' },
            { group: 'Centros de Distribuci√≥n', type: 'Intransit Receipt', alias: false, detail: 'Recepci√≥n de Transferencia a 2 Pasos', origin: 'DP o INV', script_usage: 'Clasificado como RECEPCIONES.' },
            { group: 'Centros de Distribuci√≥n', type: 'Move Order Transfer', alias: false, detail: 'Movimiento entre localizadores', origin: 'Pantalla de TELNET o DISPOSITIVO', script_usage: 'No se considera para la productividad (movimiento interno).' },
            { group: 'Centros de Distribuci√≥n', type: 'PO Receipt', alias: false, detail: 'Recepci√≥n de OC', origin: 'Ejecutado por INV', script_usage: 'Clasificado como COMPRAS - IMPORTACIONES.' },
            { group: 'Centros de Distribuci√≥n', type: 'Residual Qty issue', alias: false, detail: 'Ajuste de salida autom√°tico de sistema, CANTIDAD RESIDUAL', origin: 'Autom√°tico de sistema', script_usage: 'No se considera para la productividad.' },
            { group: 'Centros de Distribuci√≥n', type: 'Residual Qty Receipt', alias: false, detail: 'Ajuste de ingreso autom√°tico de sistema, CANTIDAD RESIDUAL', origin: 'Autom√°tico de sistema', script_usage: 'No se considera para la productividad.' },
            { group: 'Centros de Distribuci√≥n', type: 'RMA Receipt', alias: false, detail: 'Recepci√≥n de DEVOLUCI√ìN', origin: 'Ejecutado por Operadores', script_usage: 'Clasificado como DEVOLUCIONES.' },
            { group: 'Centros de Distribuci√≥n', type: 'Sales order issue', alias: false, detail: 'Salida por pedido registrado (venta, donaci√≥n, etc)', origin: 'Pedidos comerciales', script_usage: 'Clasificado como VENTAS.' },
            { group: 'Centros de Distribuci√≥n', type: 'Salida Ventas CS', alias: true, detail: 'Baja de Stock de CS por compra ejecutada por SOFIA', origin: 'Autom√°tico de sistema', script_usage: 'No se considera para la productividad.' },
            { group: 'Centros de Distribuci√≥n', type: 'Subinventory Transfer', alias: false, detail: 'Movimiento entre subinventarios', origin: 'Pantalla de TELNET o DISPOSITIVO', script_usage: 'Clasificado como RECEPCIONES si el subinventario destino es el 07.' },
            { group: 'Centros de Distribuci√≥n', type: 'Transfer to Regular', alias: false, detail: 'Actualizaci√≥n de informe al acuerdo de Custodia con CS', origin: 'Autom√°tico de sistema', script_usage: 'No se considera (no es movimiento f√≠sico).' },
            { group: 'Centros de Distribuci√≥n', type: 'Reversion salida venta CS', alias: true, detail: 'Ingreso de Stock de CS por reversi√≥n compra ejecutada por SOFIA', origin: 'Autom√°tico de sistema', script_usage: 'No se considera para la productividad.' },
            { group: 'Centros de Distribuci√≥n', type: 'Logical Intransit Receipt', alias: false, detail: 'Movimiento virtual, nativo de EBS', origin: 'Autom√°tico de sistema', script_usage: 'No se considera (no es movimiento f√≠sico).' },
            { group: 'Centros de Distribuci√≥n', type: 'Return to Vendor', alias: false, detail: 'Reversi√≥n de OC', origin: 'Ejecutado por Operadores', script_usage: 'Clasificado como COMPRAS - IMPORTACIONES.' }
        ]
    };

    let inventoryChart, transportChart, personnelChart;
    
    const setupExplorationTabs = () => {
        const tabsContainer = document.getElementById('exploration-tabs');
        const contentContainer = document.getElementById('tab-content');
        
        tabsContainer.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const tabName = e.target.dataset.tab;

                Array.from(tabsContainer.children).forEach(button => {
                    button.classList.replace('active-tab', 'inactive-tab');
                });
                e.target.classList.replace('inactive-tab', 'active-tab');

                Array.from(contentContainer.children).forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(`${tabName}-content`).classList.remove('hidden');
            }
        });
    };
    
    const setupLogicPills = () => {
        const pillsContainer = document.getElementById('logic-pills');
        const contentContainer = document.getElementById('logic-details-content');

        pillsContainer.addEventListener('click', (e) => {
             if (e.target.tagName === 'BUTTON') {
                const logicType = e.target.dataset.logic;
                
                Array.from(pillsContainer.children).forEach(button => {
                   button.classList.replace('active-pill', 'inactive-pill');
                });
                e.target.classList.replace('inactive-pill', 'active-pill');

                Array.from(contentContainer.children).forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(`${logicType}-logic-content`).classList.remove('hidden');
             }
        });
    };

    const setupBranchTabs = () => {
        const tabsContainer = document.getElementById('branch-tabs');
        
        tabsContainer.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const branchName = e.target.dataset.branch;
                updateBranchLogic(branchName);

                Array.from(tabsContainer.children).forEach(button => {
                    button.classList.replace('active-tab', 'inactive-tab');
                });
                e.target.classList.replace('inactive-tab', 'active-tab');
            }
        });
    };
    
    const setupInventoryOpPills = () => {
        const pillsContainer = document.getElementById('inventory-op-pills');
        pillsContainer.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const opName = e.target.dataset.op;
                updateInventoryLogic(opName);
                
                Array.from(pillsContainer.children).forEach(button => {
                   button.classList.replace('active-pill', 'inactive-pill');
                });
                e.target.classList.replace('inactive-pill', 'active-pill');
                
                const opIndex = Array.from(pillsContainer.children).indexOf(e.target);
                updateInventoryChartHighlight(opIndex);
            }
        });
    };

    const setupPersonnelPills = () => {
        const pillsContainer = document.getElementById('personnel-pills');
        pillsContainer.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const personnelType = e.target.dataset.personnel;
                updatePersonnelDetails(personnelType);
                
                Array.from(pillsContainer.children).forEach(button => {
                   button.classList.replace('active-pill', 'inactive-pill');
                });
                e.target.classList.replace('inactive-pill', 'active-pill');
            }
        });
    };

    const updateInventoryLogic = (op) => {
        document.getElementById('inventory-logic-code').textContent = logicData.inventory[op];
    };
    
    const updateBranchLogic = (branch) => {
        const data = logicData.branch[branch];
        document.getElementById('branch-title').textContent = data.title;
        document.getElementById('branch-description').innerHTML = data.description;
        document.getElementById('branch-logic-code').textContent = data.code;
    };

    const updatePersonnelDetails = (type) => {
        const details = logicData.personnel[type];
        document.getElementById('personnel-title').textContent = details.title;
        document.getElementById('personnel-description').textContent = details.description;
        
        const tableBody = document.getElementById('personnel-table-body');
        tableBody.innerHTML = '';
        details.data.forEach(item => {
            const row = `
                <tr class="bg-white hover:bg-slate-50">
                    <td class="px-4 py-3 font-medium text-slate-900">${item.id}</td>
                    <td class="px-4 py-3">${item.condition}</td>
                    <td class="px-4 py-3"><span class="bg-sky-100 text-sky-800 text-xs font-medium px-2 py-0.5 rounded">${item.branch}</span></td>
                    <td class="px-4 py-3 text-slate-500 italic">${item.comment || '-'}</td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    };
    
    const createInventoryChart = () => {
        const ctx = document.getElementById('inventoryChart').getContext('2d');
        if (inventoryChart) inventoryChart.destroy();
        inventoryChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Recepciones', 'Ventas', 'Env√≠os', 'Devoluciones', 'Salidas a SAP', 'Otros'],
                datasets: [{
                    label: 'Distribuci√≥n de Transacciones',
                    data: [35, 40, 10, 8, 5, 2],
                    backgroundColor: ['#0ea5e9', '#10b981', '#8b5cf6', '#f97316', '#f43f5e', '#64748b'],
                    borderColor: '#f8fafc',
                    borderWidth: 4,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.raw}%`;
                            }
                        }
                    }
                }
            }
        });
    };
    
    const updateInventoryChartHighlight = (index) => {
        if (!inventoryChart) return;
        inventoryChart.options.plugins.legend.onClick(null, inventoryChart.legend.legendItems[index]);
        inventoryChart.update();
    };

    const createPersonnelChart = () => {
        const ctx = document.getElementById('personnelChart').getContext('2d');
        if (personnelChart) personnelChart.destroy();
        personnelChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Horas Totales Registradas'],
                datasets: [{
                    label: 'Horas Productivas',
                    data: [88],
                    backgroundColor: '#10b981',
                }, {
                    label: 'Horas Personal Reubicado',
                    data: [8],
                    backgroundColor: '#f97316',
                }, {
                    label: 'Horas Comisi√≥n Sindical',
                    data: [4],
                    backgroundColor: '#ef4444',
                }]
            },
            options: {
                scales: {
                    x: { stacked: true },
                    y: { 
                        stacked: true,
                        max: 100,
                        ticks: {
                            callback: (value) => value + '%'
                        }
                    }
                },
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Distribuci√≥n de Horas del Personal'
                    },
                    legend: { position: 'bottom' },
                    tooltip: {
                        callbacks: {
                            label: (context) => `${context.dataset.label}: ${context.raw}%`
                        }
                    }
                }
            }
        });
    };
    
    const populateTransactions = (filterGroup = 'Todos', searchTerm = '') => {
        const container = document.getElementById('transaction-container');
        container.innerHTML = '';
        const filtered = logicData.transactions.filter(t => {
            const groupMatch = filterGroup === 'Todos' || t.group === filterGroup;
            const termMatch = searchTerm === '' || t.type.toLowerCase().includes(searchTerm.toLowerCase());
            return groupMatch && termMatch;
        });

        if (filtered.length === 0) {
            container.innerHTML = `<p class="text-slate-500 col-span-full text-center">No se encontraron transacciones.</p>`;
            return;
        }

        filtered.forEach(t => {
            const card = `
                <div class="bg-white p-4 rounded-lg shadow-md border border-slate-200">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-bold text-slate-800 flex-1">${t.type}</h4>
                        <span class="text-xs font-semibold px-2 py-0.5 rounded-full ${t.group === 'SAP' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'}">${t.group}</span>
                    </div>
                    <p class="text-sm text-slate-600">${t.detail}</p>
                    <div class="mt-3 pt-3 border-t border-slate-200 text-xs space-y-2">
                        <p><strong class="font-semibold text-slate-700">Origen:</strong> ${t.origin}</p>
                        <p><strong class="font-semibold text-slate-700">Requiere Alias:</strong> ${t.alias ? '<span class="text-red-600 font-bold">S√≠</span>' : 'No'}</p>
                    </div>
                    <div class="mt-3 pt-3 border-t border-dashed border-sky-300 text-xs">
                        <p class="font-bold text-sky-800">Anatom√≠a en el Script:</p>
                        <p class="text-sky-700 italic">${t.script_usage}</p>
                    </div>
                </div>
            `;
            container.innerHTML += card;
        });
    };
    
    const populateWarehouseFilters = () => {
        const sucFilter = document.getElementById('warehouse-filter-suc');
        const groupFilter = document.getElementById('warehouse-filter-group');
        
        const sucs = [...new Set(logicData.warehouses.map(w => w.SUC))].filter(Boolean).sort();
        const groups = [...new Set(logicData.warehouses.map(w => w.GRUPO_ORGANIZACIONES))].filter(Boolean).sort();

        sucFilter.innerHTML = '<option value="Todos">Todas las Sucursales</option>';
        sucs.forEach(s => sucFilter.innerHTML += `<option value="${s}">${s}</option>`);

        groupFilter.innerHTML = '<option value="Todos">Todos los Grupos</option>';
        groups.forEach(g => groupFilter.innerHTML += `<option value="${g}">${g}</option>`);
    };

    const populateWarehouses = (filterSuc = 'Todos', filterGroup = 'Todos', searchTerm = '') => {
        const container = document.getElementById('warehouse-container');
        container.innerHTML = '';
        const filtered = logicData.warehouses.filter(w => {
            const sucMatch = filterSuc === 'Todos' || w.SUC === filterSuc;
            const groupMatch = filterGroup === 'Todos' || w.GRUPO_ORGANIZACIONES === filterGroup;
            const termMatch = searchTerm === '' || w.ALMACEN.toLowerCase().includes(searchTerm.toLowerCase()) || w.ALMACEN_DESCRIPCION.toLowerCase().includes(searchTerm.toLowerCase());
            return sucMatch && groupMatch && termMatch;
        });

        if (filtered.length === 0) {
            container.innerHTML = `<p class="text-slate-500 col-span-full text-center">No se encontraron almacenes que coincidan con los filtros.</p>`;
            return;
        }

        filtered.forEach(w => {
            const card = `
                <div class="bg-white p-4 rounded-lg shadow-md border border-slate-200 transaction-card transition-all duration-200">
                    <div class="flex justify-between items-start">
                        <h4 class="font-bold text-slate-800">${w.ALMACEN} <span class="text-sm font-normal text-slate-500">(${w.ORGANIZATION_ID})</span></h4>
                        <span class="text-xs font-semibold px-2 py-0.5 rounded-full bg-sky-100 text-sky-800">${w.SUC || 'N/A'}</span>
                    </div>
                    <p class="text-sm text-slate-600 mt-2">${w.ALMACEN_DESCRIPCION}</p>
                    <div class="mt-4 pt-3 border-t border-slate-200 text-xs space-y-2">
                        <p><strong class="font-semibold text-slate-700">Grupo:</strong> ${w.GRUPO_ORGANIZACIONES}</p>
                        <p><strong class="font-semibold text-slate-700">Agrupador:</strong> ${w.Almacen_Agrupador || 'N/A'}</p>
                    </div>
                </div>
            `;
            container.innerHTML += card;
        });
    };

    const setupWarehouseFilters = () => {
        const sucFilter = document.getElementById('warehouse-filter-suc');
        const groupFilter = document.getElementById('warehouse-filter-group');
        const searchInput = document.getElementById('warehouse-search');

        const applyFilters = () => {
            const suc = sucFilter.value;
            const group = groupFilter.value;
            const search = searchInput.value;
            populateWarehouses(suc, group, search);
        };

        sucFilter.addEventListener('change', applyFilters);
        groupFilter.addEventListener('change', applyFilters);
        searchInput.addEventListener('input', applyFilters);
    };

    const setupTransactionFilters = () => {
        const groupFilter = document.getElementById('transaction-filter-group');
        const searchInput = document.getElementById('transaction-search');

        const applyFilters = () => {
            const group = groupFilter.value;
            const search = searchInput.value;
            populateTransactions(group, search);
        };

        groupFilter.addEventListener('change', applyFilters);
        searchInput.addEventListener('input', applyFilters);
    };


    // Initial Setup
    setupExplorationTabs();
    setupLogicPills();
    setupBranchTabs();
    setupInventoryOpPills();
    setupPersonnelPills();
    populateWarehouseFilters();
    setupWarehouseFilters();
    setupTransactionFilters();
    
    // Default states
    updateInventoryLogic('RECEPCIONES');
    updateBranchLogic('SCZ');
    updatePersonnelDetails('reubicados');
    populateWarehouses();
    populateTransactions();
    
    // Set default active pills and tabs
    document.querySelector('#exploration-tabs button[data-tab="logic"]').click();
    document.querySelector('#logic-pills button[data-logic="inventory"]').click();
    document.querySelector('#inventory-op-pills button[data-op="RECEPCIONES"]').classList.replace('inactive-pill', 'active-pill');
    
    // Create charts
    createInventoryChart();
    createPersonnelChart();

});
</script>

</body>
</html>
